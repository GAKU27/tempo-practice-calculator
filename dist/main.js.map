{
  "version": 3,
  "sources": ["../src/types/index.ts", "../src/core/DeviceIdentifier.ts", "../src/core/PrecisionTimer.ts", "../src/core/ActionLogger.ts", "../src/core/Calculator.ts", "../src/core/WakeLock.ts", "../src/core/Metronome.ts", "../src/ui/TouchController.ts", "../src/ui/ThemeManager.ts", "../src/ui/DataManager.ts", "../src/ui/CalculatorUI.ts", "../src/ui/MetronomeUI.ts", "../src/ui/TimerUI.ts", "../src/ui/PracticeRecordsUI.ts", "../src/ui/NavigationManager.ts", "../src/ui/VisualEffects.ts", "../src/main.ts"],
  "sourcesContent": ["/**\r\n * Tempo Practice Calculator - Type Definitions\r\n * \u3059\u3079\u3066\u306E\u578B\u5B9A\u7FA9\u3092\u96C6\u7D04\r\n */\r\n\r\n// ========================================\r\n// DOM Elements\r\n// ========================================\r\n\r\nexport interface AppElements {\r\n    form: HTMLFormElement | null;\r\n    resultsSection: HTMLElement | null;\r\n    totalTimeDisplay: HTMLElement | null;\r\n    totalTimeSecondsDisplay: HTMLElement | null;\r\n    stepCountDisplay: HTMLElement | null;\r\n    actualEndTempoDisplay: HTMLElement | null;\r\n    exactTimeDisplay: HTMLElement | null;\r\n    approxTimeDisplay: HTMLElement | null;\r\n    errorRateDisplay: HTMLElement | null;\r\n    totalBeatsPerStepDisplay: HTMLElement | null;\r\n    bpmDisplay: HTMLElement | null;\r\n    bpmSlider: HTMLInputElement | null;\r\n    pendulumArm: HTMLElement | null;\r\n    pendulumWeight: HTMLElement | null;\r\n    visualCircle: HTMLElement | null;\r\n}\r\n\r\n// ========================================\r\n// Metronome\r\n// ========================================\r\n\r\nexport type SoundType = 'click' | 'wood' | 'beep';\r\n\r\nexport interface MetronomeConfig {\r\n    tempo: number;\r\n    beatsPerBar: number;\r\n    subdivision: number;\r\n    soundType: SoundType;\r\n    volume: number;\r\n    pendulumEnabled: boolean;\r\n    progressionEnabled: boolean;\r\n    progressionStep: number;\r\n    progressionBars: number;\r\n    targetTempo: number;\r\n}\r\n\r\nexport interface MetronomeState {\r\n    isPlaying: boolean;\r\n    currentBeatInBar: number;\r\n    currentSubdivision: number;\r\n    nextNoteTime: number;\r\n    barCount: number;\r\n    pendulumDirection: 'left' | 'right';\r\n}\r\n\r\n// ========================================\r\n// Calculator\r\n// ========================================\r\n\r\nexport interface CalculatorParams {\r\n    a: number;  // \u958B\u59CB\u30C6\u30F3\u30DD (BPM)\r\n    b: number;  // \u76EE\u6A19\u30C6\u30F3\u30DD (BPM)\r\n    s: number;  // \u30B9\u30C6\u30C3\u30D7\u5E45 (BPM)\r\n    B: number;  // \u30D5\u30EC\u30FC\u30BA\u62CD\u6570\r\n    R: number;  // \u53CD\u5FA9\u56DE\u6570\r\n    N: number;  // \u30BB\u30C3\u30C8\u6570\r\n}\r\n\r\nexport interface CalculatorResults {\r\n    exactSeconds: number;\r\n    approxSeconds: number;\r\n    errorRate: number;\r\n}\r\n\r\nexport interface CalculatorMetadata {\r\n    nSteps: number;\r\n    actualEndTempo: number;\r\n    totalBeatsPerStep: number;\r\n    timeConstantC: number;\r\n    inputParams: CalculatorParams;\r\n}\r\n\r\nexport interface CalculatorOutput {\r\n    results: CalculatorResults;\r\n    metadata: CalculatorMetadata;\r\n}\r\n\r\n// ========================================\r\n// Timer\r\n// ========================================\r\n\r\nexport interface TimerState {\r\n    elapsedTime: number;\r\n    isRunning: boolean;\r\n    isCountdown: boolean;\r\n    countdownTarget: number;\r\n    laps: LapEntry[];\r\n    lastLapTime: number;\r\n}\r\n\r\nexport interface LapEntry {\r\n    time: number;\r\n    diff: number;\r\n}\r\n\r\n// ========================================\r\n// Logging\r\n// ========================================\r\n\r\nexport interface ActionLogEntry {\r\n    timestamp: number;\r\n    action: string;\r\n    details?: Record<string, unknown>;\r\n    latency?: number;\r\n}\r\n\r\n// ========================================\r\n// Theme\r\n// ========================================\r\n\r\nexport interface ThemeConfig {\r\n    backgroundColor: string;\r\n    borderColor: string;\r\n    textColor: string;\r\n    accentColor: string;\r\n}\r\n\r\nexport type ThemeMode = 'dark' | 'light';\r\n\r\n// ========================================\r\n// Settings\r\n// ========================================\r\n\r\nexport interface AppSettings {\r\n    deviceId: string;\r\n    theme: ThemeConfig;\r\n    themeMode: ThemeMode;\r\n    metronome: Partial<MetronomeConfig>;\r\n}\r\n\r\n// ========================================\r\n// Storage Keys\r\n// ========================================\r\n\r\nexport const STORAGE_KEYS = {\r\n    DEVICE_ID: 'tpc_device_id',\r\n    ACTION_LOG: 'tpc_action_log',\r\n    THEME: 'tpc_theme',\r\n    SETTINGS: 'tpc_settings',\r\n    PRACTICE_RECORDS: 'tpc_practice_records'\r\n} as const;\r\n", "/**\r\n * DeviceIdentifier - \u500B\u4F53\u8B58\u5225\u7BA1\u7406\r\n * \u30D6\u30E9\u30A6\u30B6\u56FA\u6709\u306E\u8B58\u5225\u5B50\u3092\u751F\u6210\u30FB\u4FDD\u5B58\u3057\u3001\u30E6\u30FC\u30B6\u30FC\u9078\u629E\u306A\u3057\u3067\r\n * \u305D\u306E\u30D6\u30E9\u30A6\u30B6\u5C02\u7528\u306E\u30C7\u30FC\u30BF\u3092\u81EA\u52D5\u3067\u30ED\u30FC\u30C9\u3059\u308B\u4ED5\u7D44\u307F\r\n */\r\n\r\nimport { STORAGE_KEYS } from '../types';\r\n\r\nexport class DeviceIdentifier {\r\n    private static instance: DeviceIdentifier | null = null;\r\n    private deviceId: string;\r\n\r\n    private constructor() {\r\n        this.deviceId = this.loadOrCreate();\r\n    }\r\n\r\n    /**\r\n     * \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\r\n     */\r\n    static getInstance(): DeviceIdentifier {\r\n        if (!DeviceIdentifier.instance) {\r\n            DeviceIdentifier.instance = new DeviceIdentifier();\r\n        }\r\n        return DeviceIdentifier.instance;\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30D0\u30A4\u30B9ID\u3092\u53D6\u5F97\r\n     */\r\n    getId(): string {\r\n        return this.deviceId;\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30D0\u30A4\u30B9ID\u3092\u518D\u751F\u6210\uFF08\u30C7\u30FC\u30BF\u6D88\u53BB\u6642\u306B\u4F7F\u7528\uFF09\r\n     */\r\n    regenerate(): string {\r\n        this.deviceId = this.generateUUID();\r\n        this.save();\r\n        return this.deviceId;\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30D0\u30A4\u30B9ID\u3092\u5B8C\u5168\u306B\u524A\u9664\r\n     */\r\n    clear(): void {\r\n        try {\r\n            localStorage.removeItem(STORAGE_KEYS.DEVICE_ID);\r\n        } catch (e) {\r\n            console.warn('Failed to clear device ID:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30FC\u30AB\u30EB\u30B9\u30C8\u30EC\u30FC\u30B8\u304B\u3089\u8AAD\u307F\u8FBC\u307F\u3001\u306A\u3051\u308C\u3070\u65B0\u898F\u751F\u6210\r\n     */\r\n    private loadOrCreate(): string {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEYS.DEVICE_ID);\r\n            if (saved && this.isValidUUID(saved)) {\r\n                return saved;\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load device ID:', e);\r\n        }\r\n\r\n        const newId = this.generateUUID();\r\n        this.deviceId = newId;\r\n        this.save();\r\n        return newId;\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30FC\u30AB\u30EB\u30B9\u30C8\u30EC\u30FC\u30B8\u306B\u4FDD\u5B58\r\n     */\r\n    private save(): void {\r\n        try {\r\n            localStorage.setItem(STORAGE_KEYS.DEVICE_ID, this.deviceId);\r\n        } catch (e) {\r\n            console.warn('Failed to save device ID:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * UUID v4\u5F62\u5F0F\u306EID\u3092\u751F\u6210\r\n     */\r\n    private generateUUID(): string {\r\n        // crypto.randomUUID()\u304C\u5229\u7528\u53EF\u80FD\u306A\u5834\u5408\u306F\u305D\u308C\u3092\u4F7F\u7528\uFF08\u3088\u308A\u5B89\u5168\uFF09\r\n        if (typeof crypto !== 'undefined' && crypto.randomUUID) {\r\n            return crypto.randomUUID();\r\n        }\r\n\r\n        // \u30D5\u30A9\u30FC\u30EB\u30D0\u30C3\u30AF: \u624B\u52D5\u751F\u6210\r\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\r\n            const r = (Math.random() * 16) | 0;\r\n            const v = c === 'x' ? r : (r & 0x3) | 0x8;\r\n            return v.toString(16);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * UUID\u5F62\u5F0F\u306E\u691C\u8A3C\r\n     */\r\n    private isValidUUID(str: string): boolean {\r\n        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\r\n        return uuidRegex.test(str);\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30D0\u30A4\u30B9\u60C5\u5831\u306E\u30B5\u30DE\u30EA\u30FC\u3092\u53D6\u5F97\uFF08\u30C7\u30D0\u30C3\u30B0\u7528\uFF09\r\n     */\r\n    getDeviceInfo(): Record<string, string> {\r\n        return {\r\n            deviceId: this.deviceId,\r\n            userAgent: navigator.userAgent,\r\n            platform: navigator.platform,\r\n            language: navigator.language,\r\n            createdAt: new Date().toISOString()\r\n        };\r\n    }\r\n}\r\n\r\n// \u4F7F\u3044\u3084\u3059\u3055\u306E\u305F\u3081\u306E\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\u95A2\u6570\r\nexport function getDeviceId(): string {\r\n    return DeviceIdentifier.getInstance().getId();\r\n}\r\n\r\nexport function clearDeviceId(): void {\r\n    DeviceIdentifier.getInstance().clear();\r\n}\r\n", "/**\r\n * PrecisionTimer - \u9AD8\u7CBE\u5EA6\u540C\u671F\u30A8\u30F3\u30B8\u30F3\r\n * \u63CF\u753B\u306E\u5468\u671F\u3092\u30B7\u30B9\u30C6\u30E0\u6642\u523B\uFF08\u30DF\u30EA\u79D2\uFF09\u3068\u540C\u671F\u3055\u305B\u3001\r\n * \u30D6\u30E9\u30A6\u30B6\u306E\u8CA0\u8377\u306B\u3088\u308B\u9045\u5EF6\u3092\u81EA\u52D5\u7684\u306B\u88DC\u6B63\u3059\u308B\u30ED\u30B8\u30C3\u30AF\r\n */\r\n\r\nexport interface TimingMetrics {\r\n    scheduledTime: number;\r\n    actualTime: number;\r\n    drift: number;\r\n    cumulativeDrift: number;\r\n}\r\n\r\nexport class PrecisionTimer {\r\n    private audioContext: AudioContext | null = null;\r\n    private driftHistory: number[] = [];\r\n    private cumulativeDrift: number = 0;\r\n    private lastScheduledTime: number = 0;\r\n    private lastActualTime: number = 0;\r\n    private readonly MAX_DRIFT_SAMPLES = 20;\r\n    private readonly DRIFT_CORRECTION_FACTOR = 0.15;\r\n\r\n    /**\r\n     * AudioContext\u3092\u521D\u671F\u5316\uFF08\u30E6\u30FC\u30B6\u30FC\u30A2\u30AF\u30B7\u30E7\u30F3\u5185\u3067\u547C\u3073\u51FA\u3059\u5FC5\u8981\u3042\u308A\uFF09\r\n     */\r\n    async initialize(): Promise<void> {\r\n        if (this.audioContext) return;\r\n\r\n        try {\r\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n\r\n            // Suspended\u72B6\u614B\u306E\u5834\u5408\u306Fresume\r\n            if (this.audioContext.state === 'suspended') {\r\n                await this.audioContext.resume();\r\n            }\r\n\r\n            // \u30A6\u30A9\u30FC\u30E0\u30A2\u30C3\u30D7: \u7121\u97F3\u30D0\u30C3\u30D5\u30A1\u3092\u518D\u751F\u3057\u3066\u30AA\u30FC\u30C7\u30A3\u30AA\u30D1\u30A4\u30D7\u30E9\u30A4\u30F3\u3092\u6E96\u5099\r\n            const buffer = this.audioContext.createBuffer(1, 1, 22050);\r\n            const source = this.audioContext.createBufferSource();\r\n            source.buffer = buffer;\r\n            source.connect(this.audioContext.destination);\r\n            source.start(0);\r\n        } catch (e) {\r\n            console.warn('Failed to initialize AudioContext:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u9AD8\u7CBE\u5EA6\u30BF\u30A4\u30E0\u30B9\u30BF\u30F3\u30D7\u3092\u53D6\u5F97\r\n     * AudioContext\u304C\u5229\u7528\u53EF\u80FD\u306A\u5834\u5408\u306F\u305D\u308C\u3092\u4F7F\u7528\uFF08\u3088\u308A\u6B63\u78BA\uFF09\r\n     */\r\n    now(): number {\r\n        if (this.audioContext && this.audioContext.state === 'running') {\r\n            return this.audioContext.currentTime * 1000; // \u79D2\u2192\u30DF\u30EA\u79D2\r\n        }\r\n        return performance.now();\r\n    }\r\n\r\n    /**\r\n     * \u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u3092\u6307\u5B9A\u6642\u9593\u5F8C\u306B\u5B9F\u884C\uFF08\u81EA\u52D5\u30C9\u30EA\u30D5\u30C8\u88DC\u6B63\u4ED8\u304D\uFF09\r\n     */\r\n    scheduleCallback(callback: () => void, delayMs: number): number {\r\n        const scheduledTime = this.now() + delayMs;\r\n        const correctedDelay = this.getCorrectedDelay(delayMs);\r\n\r\n        const timerId = window.setTimeout(() => {\r\n            const actualTime = this.now();\r\n            this.recordTiming(scheduledTime, actualTime);\r\n            callback();\r\n        }, correctedDelay);\r\n\r\n        this.lastScheduledTime = scheduledTime;\r\n        return timerId;\r\n    }\r\n\r\n    /**\r\n     * \u7E70\u308A\u8FD4\u3057\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u3092\u5B9F\u884C\uFF08\u9AD8\u7CBE\u5EA6\u30EB\u30FC\u30D7\uFF09\r\n     */\r\n    scheduleRepeating(\r\n        callback: (metrics: TimingMetrics) => void,\r\n        intervalMs: number\r\n    ): () => void {\r\n        let isRunning = true;\r\n        let nextTime = this.now();\r\n\r\n        const tick = () => {\r\n            if (!isRunning) return;\r\n\r\n            const actualTime = this.now();\r\n            const drift = actualTime - nextTime;\r\n\r\n            this.recordDrift(drift);\r\n\r\n            const metrics: TimingMetrics = {\r\n                scheduledTime: nextTime,\r\n                actualTime,\r\n                drift,\r\n                cumulativeDrift: this.cumulativeDrift\r\n            };\r\n\r\n            callback(metrics);\r\n\r\n            // \u6B21\u306E\u5B9F\u884C\u6642\u523B\u3092\u8A08\u7B97\uFF08\u30C9\u30EA\u30D5\u30C8\u3092\u88DC\u6B63\uFF09\r\n            nextTime += intervalMs;\r\n            const correctedDelay = Math.max(0, nextTime - this.now() - this.getAverageDrift() * this.DRIFT_CORRECTION_FACTOR);\r\n\r\n            setTimeout(tick, correctedDelay);\r\n        };\r\n\r\n        // \u6700\u521D\u306E\u30C6\u30A3\u30C3\u30AF\u3092\u958B\u59CB\r\n        setTimeout(tick, intervalMs);\r\n\r\n        // \u505C\u6B62\u95A2\u6570\u3092\u8FD4\u3059\r\n        return () => {\r\n            isRunning = false;\r\n        };\r\n    }\r\n\r\n    /**\r\n     * BPM\u304B\u3089\u6B63\u78BA\u306A\u30A4\u30F3\u30BF\u30FC\u30D0\u30EB\uFF08\u30DF\u30EA\u79D2\uFF09\u3092\u8A08\u7B97\r\n     */\r\n    bpmToInterval(bpm: number, subdivision: number = 1): number {\r\n        const secondsPerBeat = 60 / bpm;\r\n        const secondsPerNote = secondsPerBeat / subdivision;\r\n        return secondsPerNote * 1000;\r\n    }\r\n\r\n    /**\r\n     * \u30C9\u30EA\u30D5\u30C8\u88DC\u6B63\u6E08\u307F\u306E\u9045\u5EF6\u6642\u9593\u3092\u53D6\u5F97\r\n     */\r\n    private getCorrectedDelay(originalDelay: number): number {\r\n        const avgDrift = this.getAverageDrift();\r\n        const correction = avgDrift * this.DRIFT_CORRECTION_FACTOR;\r\n        return Math.max(0, originalDelay - correction);\r\n    }\r\n\r\n    /**\r\n     * \u30BF\u30A4\u30DF\u30F3\u30B0\u3092\u8A18\u9332\u3057\u3066\u30C9\u30EA\u30D5\u30C8\u3092\u8A08\u7B97\r\n     */\r\n    private recordTiming(scheduled: number, actual: number): void {\r\n        const drift = actual - scheduled;\r\n        this.recordDrift(drift);\r\n        this.lastActualTime = actual;\r\n    }\r\n\r\n    /**\r\n     * \u30C9\u30EA\u30D5\u30C8\u5024\u3092\u5C65\u6B74\u306B\u8FFD\u52A0\r\n     */\r\n    private recordDrift(drift: number): void {\r\n        this.driftHistory.push(drift);\r\n        this.cumulativeDrift += drift;\r\n\r\n        // \u53E4\u3044\u30B5\u30F3\u30D7\u30EB\u3092\u524A\u9664\r\n        while (this.driftHistory.length > this.MAX_DRIFT_SAMPLES) {\r\n            const removed = this.driftHistory.shift();\r\n            if (removed !== undefined) {\r\n                this.cumulativeDrift -= removed;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u5E73\u5747\u30C9\u30EA\u30D5\u30C8\u3092\u53D6\u5F97\r\n     */\r\n    private getAverageDrift(): number {\r\n        if (this.driftHistory.length === 0) return 0;\r\n        return this.cumulativeDrift / this.driftHistory.length;\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30BF\u30A4\u30DF\u30F3\u30B0\u7CBE\u5EA6\u60C5\u5831\u3092\u53D6\u5F97\r\n     */\r\n    getTimingStats(): {\r\n        averageDrift: number;\r\n        maxDrift: number;\r\n        minDrift: number;\r\n        sampleCount: number;\r\n    } {\r\n        if (this.driftHistory.length === 0) {\r\n            return { averageDrift: 0, maxDrift: 0, minDrift: 0, sampleCount: 0 };\r\n        }\r\n\r\n        return {\r\n            averageDrift: this.getAverageDrift(),\r\n            maxDrift: Math.max(...this.driftHistory),\r\n            minDrift: Math.min(...this.driftHistory),\r\n            sampleCount: this.driftHistory.length\r\n        };\r\n    }\r\n\r\n    /**\r\n     * \u30BF\u30A4\u30DF\u30F3\u30B0\u5C65\u6B74\u3092\u30EA\u30BB\u30C3\u30C8\r\n     */\r\n    reset(): void {\r\n        this.driftHistory = [];\r\n        this.cumulativeDrift = 0;\r\n        this.lastScheduledTime = 0;\r\n        this.lastActualTime = 0;\r\n    }\r\n\r\n    /**\r\n     * AudioContext\u3092\u7834\u68C4\r\n     */\r\n    destroy(): void {\r\n        if (this.audioContext) {\r\n            this.audioContext.close();\r\n            this.audioContext = null;\r\n        }\r\n        this.reset();\r\n    }\r\n}\r\n\r\n// \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\r\nlet precisionTimerInstance: PrecisionTimer | null = null;\r\n\r\nexport function getPrecisionTimer(): PrecisionTimer {\r\n    if (!precisionTimerInstance) {\r\n        precisionTimerInstance = new PrecisionTimer();\r\n    }\r\n    return precisionTimerInstance;\r\n}\r\n", "/**\r\n * ActionLogger - \u30A2\u30AF\u30B7\u30E7\u30F3\u30FB\u30A8\u30E9\u30FC\u30ED\u30B0\r\n * \u30E6\u30FC\u30B6\u30FC\u64CD\u4F5C\u5C65\u6B74\u3068\u9045\u5EF6\u3092\u8A18\u9332\u3057\u3001\u8A3A\u65AD\u30C7\u30FC\u30BF\u3092\u63D0\u4F9B\r\n */\r\n\r\nimport { ActionLogEntry, STORAGE_KEYS } from '../types';\r\nimport { getDeviceId } from './DeviceIdentifier';\r\n\r\nexport type LogLevel = 'info' | 'warn' | 'error' | 'debug';\r\n\r\nexport interface EnhancedLogEntry extends ActionLogEntry {\r\n    level: LogLevel;\r\n    deviceId: string;\r\n    sessionId: string;\r\n}\r\n\r\nexport class ActionLogger {\r\n    private static instance: ActionLogger | null = null;\r\n    private readonly MAX_ENTRIES = 500;\r\n    private readonly sessionId: string;\r\n    private logs: EnhancedLogEntry[] = [];\r\n    private startTime: number;\r\n\r\n    private constructor() {\r\n        this.sessionId = this.generateSessionId();\r\n        this.startTime = performance.now();\r\n        this.loadFromStorage();\r\n\r\n        // \u30DA\u30FC\u30B8\u96E2\u8131\u6642\u306B\u81EA\u52D5\u4FDD\u5B58\r\n        window.addEventListener('beforeunload', () => this.saveToStorage());\r\n\r\n        // \u521D\u671F\u30ED\u30B0\r\n        this.log('info', 'session_started', {\r\n            userAgent: navigator.userAgent,\r\n            viewport: { width: window.innerWidth, height: window.innerHeight }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\r\n     */\r\n    static getInstance(): ActionLogger {\r\n        if (!ActionLogger.instance) {\r\n            ActionLogger.instance = new ActionLogger();\r\n        }\r\n        return ActionLogger.instance;\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30B0\u3092\u8A18\u9332\r\n     */\r\n    log(level: LogLevel, action: string, details?: Record<string, unknown>): void {\r\n        const entry: EnhancedLogEntry = {\r\n            timestamp: Date.now(),\r\n            action,\r\n            details,\r\n            latency: this.measureLatency(),\r\n            level,\r\n            deviceId: getDeviceId(),\r\n            sessionId: this.sessionId\r\n        };\r\n\r\n        this.logs.push(entry);\r\n\r\n        // \u6700\u5927\u30A8\u30F3\u30C8\u30EA\u6570\u3092\u8D85\u3048\u305F\u3089\u53E4\u3044\u3082\u306E\u3092\u524A\u9664\r\n        while (this.logs.length > this.MAX_ENTRIES) {\r\n            this.logs.shift();\r\n        }\r\n\r\n        // \u30C7\u30D0\u30C3\u30B0\u30E2\u30FC\u30C9\u3067\u306F\u30B3\u30F3\u30BD\u30FC\u30EB\u306B\u3082\u51FA\u529B\r\n        if (level === 'error' || level === 'warn') {\r\n            console[level](`[ActionLogger] ${action}`, details);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u60C5\u5831\u30ED\u30B0\r\n     */\r\n    info(action: string, details?: Record<string, unknown>): void {\r\n        this.log('info', action, details);\r\n    }\r\n\r\n    /**\r\n     * \u8B66\u544A\u30ED\u30B0\r\n     */\r\n    warn(action: string, details?: Record<string, unknown>): void {\r\n        this.log('warn', action, details);\r\n    }\r\n\r\n    /**\r\n     * \u30A8\u30E9\u30FC\u30ED\u30B0\r\n     */\r\n    error(action: string, details?: Record<string, unknown>): void {\r\n        this.log('error', action, details);\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30D0\u30C3\u30B0\u30ED\u30B0\r\n     */\r\n    debug(action: string, details?: Record<string, unknown>): void {\r\n        this.log('debug', action, details);\r\n    }\r\n\r\n    /**\r\n     * \u3059\u3079\u3066\u306E\u30ED\u30B0\u3092\u53D6\u5F97\r\n     */\r\n    getLogs(): EnhancedLogEntry[] {\r\n        return [...this.logs];\r\n    }\r\n\r\n    /**\r\n     * \u7279\u5B9A\u306E\u30A2\u30AF\u30B7\u30E7\u30F3\u306E\u30ED\u30B0\u3092\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\r\n     */\r\n    getLogsByAction(action: string): EnhancedLogEntry[] {\r\n        return this.logs.filter(log => log.action === action);\r\n    }\r\n\r\n    /**\r\n     * \u7279\u5B9A\u306E\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\r\n     */\r\n    getLogsByLevel(level: LogLevel): EnhancedLogEntry[] {\r\n        return this.logs.filter(log => log.level === level);\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30BB\u30C3\u30B7\u30E7\u30F3\u306E\u30ED\u30B0\u306E\u307F\u53D6\u5F97\r\n     */\r\n    getCurrentSessionLogs(): EnhancedLogEntry[] {\r\n        return this.logs.filter(log => log.sessionId === this.sessionId);\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30B0\u7D71\u8A08\u3092\u53D6\u5F97\r\n     */\r\n    getStats(): {\r\n        totalLogs: number;\r\n        errorCount: number;\r\n        warnCount: number;\r\n        avgLatency: number;\r\n        sessionDuration: number;\r\n    } {\r\n        const now = performance.now();\r\n        const latencies = this.logs\r\n            .filter(log => log.latency !== undefined)\r\n            .map(log => log.latency as number);\r\n\r\n        return {\r\n            totalLogs: this.logs.length,\r\n            errorCount: this.logs.filter(log => log.level === 'error').length,\r\n            warnCount: this.logs.filter(log => log.level === 'warn').length,\r\n            avgLatency: latencies.length > 0\r\n                ? latencies.reduce((a, b) => a + b, 0) / latencies.length\r\n                : 0,\r\n            sessionDuration: now - this.startTime\r\n        };\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30B0\u3092JSON\u5F62\u5F0F\u3067\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\r\n     */\r\n    exportAsJSON(): string {\r\n        return JSON.stringify({\r\n            exportedAt: new Date().toISOString(),\r\n            deviceId: getDeviceId(),\r\n            sessionId: this.sessionId,\r\n            stats: this.getStats(),\r\n            logs: this.logs\r\n        }, null, 2);\r\n    }\r\n\r\n    /**\r\n     * \u3059\u3079\u3066\u306E\u30ED\u30B0\u3092\u30AF\u30EA\u30A2\r\n     */\r\n    clear(): void {\r\n        this.logs = [];\r\n        this.saveToStorage();\r\n        this.log('info', 'logs_cleared');\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30FC\u30AB\u30EB\u30B9\u30C8\u30EC\u30FC\u30B8\u306B\u4FDD\u5B58\r\n     */\r\n    saveToStorage(): void {\r\n        try {\r\n            // \u6700\u65B0\u306E100\u4EF6\u306E\u307F\u4FDD\u5B58\uFF08\u30B9\u30C8\u30EC\u30FC\u30B8\u7BC0\u7D04\uFF09\r\n            const logsToSave = this.logs.slice(-100);\r\n            localStorage.setItem(STORAGE_KEYS.ACTION_LOG, JSON.stringify(logsToSave));\r\n        } catch (e) {\r\n            console.warn('Failed to save action logs:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u30ED\u30FC\u30AB\u30EB\u30B9\u30C8\u30EC\u30FC\u30B8\u304B\u3089\u8AAD\u307F\u8FBC\u307F\r\n     */\r\n    private loadFromStorage(): void {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEYS.ACTION_LOG);\r\n            if (saved) {\r\n                const parsed = JSON.parse(saved);\r\n                if (Array.isArray(parsed)) {\r\n                    this.logs = parsed;\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load action logs:', e);\r\n            this.logs = [];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u30BB\u30C3\u30B7\u30E7\u30F3ID\u3092\u751F\u6210\r\n     */\r\n    private generateSessionId(): string {\r\n        return `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30EC\u30A4\u30C6\u30F3\u30B7\u3092\u8A08\u6E2C\r\n     */\r\n    private measureLatency(): number {\r\n        // performance.now\u3092\u4F7F\u7528\u3057\u3066\u9AD8\u7CBE\u5EA6\u306A\u8A08\u6E2C\r\n        return performance.now() - this.startTime;\r\n    }\r\n}\r\n\r\n// \u4FBF\u5229\u306A\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\u95A2\u6570\r\nexport function logAction(action: string, details?: Record<string, unknown>): void {\r\n    ActionLogger.getInstance().info(action, details);\r\n}\r\n\r\nexport function logError(action: string, details?: Record<string, unknown>): void {\r\n    ActionLogger.getInstance().error(action, details);\r\n}\r\n\r\nexport function logWarn(action: string, details?: Record<string, unknown>): void {\r\n    ActionLogger.getInstance().warn(action, details);\r\n}\r\n", "/**\r\n * Calculator - \u6709\u7406S-P\u516C\u5F0F\u306B\u57FA\u3065\u304F\u9AD8\u7CBE\u5EA6\u30C6\u30F3\u30DD\u8A08\u7B97\u30A8\u30F3\u30B8\u30F3\r\n */\r\n\r\nexport interface PracticeParams {\r\n    a: number; // \u958B\u59CB\u30C6\u30F3\u30DD\r\n    b: number; // \u76EE\u6A19\u30C6\u30F3\u30DD\r\n    s: number; // \u30B9\u30C6\u30C3\u30D7\u5E45\r\n    B: number; // \u62CD\u5B50\u6570\r\n    R: number; // \u53CD\u5FA9\u56DE\u6570\r\n    N: number; // \u5168\u4F53\u306E\u30BB\u30C3\u30C8\u6570\r\n}\r\n\r\nexport interface PracticeResults {\r\n    exactSeconds: number;\r\n    approxSeconds: number;\r\n    errorRate: number;\r\n}\r\n\r\nexport interface PracticeMetadata {\r\n    nSteps: number;\r\n    actualEndTempo: number;\r\n    totalBeatsPerStep: number;\r\n    timeConstantC: number;\r\n    inputParams: PracticeParams;\r\n}\r\n\r\nexport interface CalculationResult {\r\n    results: PracticeResults;\r\n    metadata: PracticeMetadata;\r\n}\r\n\r\n/**\r\n * \u9AD8\u7CBE\u5EA6\u7DCF\u548C\u8A08\u7B97\uFF08Kahan Summation\u30A2\u30EB\u30B4\u30EA\u30BA\u30E0\uFF09\r\n */\r\nfunction kahanSum(numbers: number[]): number {\r\n    let sum = 0.0;\r\n    let compensation = 0.0;\r\n\r\n    for (let i = 0; i < numbers.length; i++) {\r\n        const y = numbers[i] - compensation;\r\n        const t = sum + y;\r\n        compensation = (t - sum) - y;\r\n        sum = t;\r\n    }\r\n\r\n    return sum;\r\n}\r\n\r\n/**\r\n * \u30C6\u30F3\u30DD\u7DF4\u7FD2\u6642\u9593\u306E\u8A08\u7B97\r\n * @param params \u7DF4\u7FD2\u30D1\u30E9\u30E1\u30FC\u30BF\r\n * @returns \u8A08\u7B97\u7D50\u679C\u3068\u30E1\u30BF\u30C7\u30FC\u30BF\r\n */\r\nexport function calculateTempoPracticeTime(params: PracticeParams): CalculationResult {\r\n    const { a, b, s, B, R, N } = params;\r\n\r\n    if (s <= 0) {\r\n        throw new Error('\u30B9\u30C6\u30C3\u30D7\u5E45\u306F\u6B63\u306E\u5024\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059');\r\n    }\r\n    if (a <= 0 || b <= 0) {\r\n        throw new Error('\u30C6\u30F3\u30DD\u306F\u6B63\u306E\u5024\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059');\r\n    }\r\n    if (a >= b) {\r\n        throw new Error('\u76EE\u6A19\u30C6\u30F3\u30DD\u306F\u958B\u59CB\u30C6\u30F3\u30DD\u3088\u308A\u5927\u304D\u304F\u8A2D\u5B9A\u3057\u3066\u304F\u3060\u3055\u3044');\r\n    }\r\n    if (B <= 0 || R <= 0 || N <= 0) {\r\n        throw new Error('\u62CD\u6570\u3001\u53CD\u5FA9\u56DE\u6570\u3001\u30BB\u30C3\u30C8\u6570\u306F\u6B63\u306E\u6574\u6570\u3067\u3042\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059');\r\n    }\r\n\r\n    const K = B * R;\r\n    const n = Math.floor((b - a) / s);\r\n    const bPrime = a + n * s;\r\n    const C = 60 * K;\r\n\r\n    const stepTimes: number[] = [];\r\n    for (let k = 0; k <= n; k++) {\r\n        const tempo = a + s * k;\r\n        const stepTime = C / tempo;\r\n        stepTimes.push(stepTime);\r\n    }\r\n\r\n    const sumExact = kahanSum(stepTimes);\r\n    const totalExact = sumExact * N;\r\n\r\n    const S = a + bPrime;\r\n    const P = a * bPrime;\r\n    const termIntegral = (4 * n * S) / (S * S + 4 * P);\r\n    const termCorrection = S / (2 * P);\r\n    const sumApprox = C * (termIntegral + termCorrection);\r\n    const totalApprox = sumApprox * N;\r\n    const errorRate = ((totalApprox - totalExact) / totalExact) * 100;\r\n\r\n    return {\r\n        results: {\r\n            exactSeconds: totalExact,\r\n            approxSeconds: totalApprox,\r\n            errorRate: errorRate\r\n        },\r\n        metadata: {\r\n            nSteps: n,\r\n            actualEndTempo: bPrime,\r\n            totalBeatsPerStep: K,\r\n            timeConstantC: C,\r\n            inputParams: { a, b, s, B, R, N }\r\n        }\r\n    };\r\n}\r\n\r\n/**\r\n * \u79D2\u6570\u3092\u5206:\u79D2\u5F62\u5F0F\u306B\u30D5\u30A9\u30FC\u30DE\u30C3\u30C8\r\n */\r\nexport function formatTime(seconds: number): string {\r\n    const hours = Math.floor(seconds / 3600);\r\n    const minutes = Math.floor((seconds % 3600) / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n\r\n    if (hours > 0) {\r\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\r\n    }\r\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\r\n}\r\n", "export class WakeLock {\r\n    private wakeLock: any = null;\r\n    private static instance: WakeLock;\r\n\r\n    private constructor() {\r\n        document.addEventListener('visibilitychange', () => {\r\n            if (this.wakeLock !== null && document.visibilityState === 'visible') {\r\n                this.requestWakeLock();\r\n            }\r\n        });\r\n    }\r\n\r\n    public static getInstance(): WakeLock {\r\n        if (!WakeLock.instance) {\r\n            WakeLock.instance = new WakeLock();\r\n        }\r\n        return WakeLock.instance;\r\n    }\r\n\r\n    public async requestWakeLock() {\r\n        try {\r\n            if ('wakeLock' in navigator) {\r\n                this.wakeLock = await (navigator as any).wakeLock.request('screen');\r\n                console.log('[TPC] Screen Wake Lock is active');\r\n\r\n                this.wakeLock.addEventListener('release', () => {\r\n                    console.log('[TPC] Screen Wake Lock was released');\r\n                });\r\n            } else {\r\n                console.warn('[TPC] Screen Wake Lock API not supported in this browser.');\r\n            }\r\n        } catch (err: any) {\r\n            console.error(`[TPC] Wake Lock error: ${err.name}, ${err.message}`);\r\n        }\r\n    }\r\n\r\n    public releaseWakeLock() {\r\n        if (this.wakeLock !== null) {\r\n            this.wakeLock.release()\r\n                .then(() => {\r\n                    this.wakeLock = null;\r\n                });\r\n        }\r\n    }\r\n}\r\n", "/**\r\n * Metronome - Web Audio API \u30A8\u30F3\u30B8\u30F3\r\n */\r\nimport { WakeLock } from './WakeLock';\r\n\r\nexport class Metronome {\r\n    private audioContext: AudioContext | null = null;\r\n    public isPlaying: boolean = false;\r\n    private wakeLock: WakeLock;\r\n\r\n    private currentBeatInBar: number = 0;\r\n    private currentSubdivision: number = 0;\r\n    private beatsPerBar: number = 4;\r\n    private subdivision: number = 1; // 1=quarter, 2=eighth, 3=triplet, 4=sixteenth\r\n    private tempo: number = 120;\r\n\r\n    private lookahead: number = 25.0; // ms\r\n    private scheduleAheadTime: number = 0.1; // seconds\r\n    private nextNoteTime: number = 0.0;\r\n    private timerID: number | null = null;\r\n\r\n    private soundType: 'click' | 'wood' | 'beep' = 'click';\r\n    private volume: number = 0.8; // 0.0 - 1.0\r\n\r\n    private pendulumEnabled: boolean = true;\r\n    private pendulumDirection: 'left' | 'right' = 'left';\r\n    private pendulumArm: HTMLElement | null = null;\r\n\r\n    private visualCallback: ((beatNumber: number, isMainBeat: boolean, isAccent: boolean) => void) | null = null;\r\n    private pendulumCallback: ((direction: 'left' | 'right') => void) | null = null;\r\n\r\n    constructor() {\r\n        this.wakeLock = WakeLock.getInstance();\r\n    }\r\n\r\n    setVisualCallback(callback: (beatNumber: number, isMainBeat: boolean, isAccent: boolean) => void) {\r\n        this.visualCallback = callback;\r\n    }\r\n\r\n    setPendulumCallback(callback: (direction: 'left' | 'right') => void) {\r\n        this.pendulumCallback = callback;\r\n    }\r\n\r\n    private nextNote() {\r\n        // Calculate time based on subdivision\r\n        const baseSecondsPerBeat = 60.0 / this.tempo;\r\n        const secondsPerNote = baseSecondsPerBeat / this.subdivision;\r\n        this.nextNoteTime += secondsPerNote;\r\n\r\n        this.currentSubdivision++;\r\n        if (this.currentSubdivision >= this.subdivision) {\r\n            this.currentSubdivision = 0;\r\n            this.currentBeatInBar++;\r\n            if (this.currentBeatInBar >= this.beatsPerBar) {\r\n                this.currentBeatInBar = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    private scheduleNote(beatNumber: number, subdivisionNumber: number, time: number) {\r\n        const isMainBeat = subdivisionNumber === 0;\r\n        const isAccent = beatNumber === 0 && this.beatsPerBar > 0 && isMainBeat;\r\n\r\n        // Visual feedback\r\n        if (this.audioContext) {\r\n            requestAnimationFrame(() => {\r\n                const drawTime = (time - this.audioContext!.currentTime) * 1000;\r\n                setTimeout(() => {\r\n                    if (this.visualCallback) {\r\n                        this.visualCallback(beatNumber, isMainBeat, isAccent);\r\n                    }\r\n                    if (isMainBeat) {\r\n                        this.triggerPendulum();\r\n                    }\r\n                }, Math.max(0, drawTime));\r\n            });\r\n        }\r\n\r\n        // Subdivision sounds\r\n        switch (this.soundType) {\r\n            case 'click':\r\n                this.playClickSound(time, isAccent, isMainBeat);\r\n                break;\r\n            case 'wood':\r\n                this.playWoodSound(time, isAccent, isMainBeat);\r\n                break;\r\n            case 'beep':\r\n                this.playBeepSound(time, isAccent, isMainBeat);\r\n                break;\r\n            default:\r\n                this.playClickSound(time, isAccent, isMainBeat);\r\n        }\r\n    }\r\n\r\n    private playClickSound(time: number, isAccent: boolean, isMainBeat: boolean) {\r\n        if (!this.audioContext) return;\r\n        const osc = this.audioContext.createOscillator();\r\n        const envelope = this.audioContext.createGain();\r\n\r\n        osc.frequency.value = isAccent ? 880.0 : 440.0;\r\n\r\n        const baseVolume = isMainBeat ? 1.0 : 0.5;\r\n        envelope.gain.setValueAtTime(baseVolume * this.volume, time);\r\n        envelope.gain.exponentialRampToValueAtTime(0.001, time + 0.02);\r\n\r\n        osc.connect(envelope);\r\n        envelope.connect(this.audioContext.destination);\r\n\r\n        osc.start(time);\r\n        osc.stop(time + 0.03);\r\n    }\r\n\r\n    private playWoodSound(time: number, isAccent: boolean, isMainBeat: boolean) {\r\n        if (!this.audioContext) return;\r\n        const baseVolume = isMainBeat ? 1.0 : 0.5;\r\n\r\n        // \u30E1\u30A4\u30F3\u97F3\r\n        const osc = this.audioContext.createOscillator();\r\n        const envelope = this.audioContext.createGain();\r\n\r\n        osc.type = 'triangle';\r\n        osc.frequency.setValueAtTime(isAccent ? 1500 : 1200, time);\r\n        osc.frequency.exponentialRampToValueAtTime(isAccent ? 600 : 400, time + 0.015);\r\n\r\n        envelope.gain.setValueAtTime((isAccent ? 0.6 : 0.4) * baseVolume * this.volume, time);\r\n        envelope.gain.exponentialRampToValueAtTime(0.001, time + 0.04);\r\n\r\n        osc.connect(envelope);\r\n        envelope.connect(this.audioContext.destination);\r\n\r\n        osc.start(time);\r\n        osc.stop(time + 0.05);\r\n\r\n        // \u30A2\u30BF\u30C3\u30AF\u97F3\r\n        const click = this.audioContext.createOscillator();\r\n        const clickEnv = this.audioContext.createGain();\r\n\r\n        click.type = 'square';\r\n        click.frequency.value = isAccent ? 2000 : 1600;\r\n\r\n        clickEnv.gain.setValueAtTime((isAccent ? 0.3 : 0.2) * baseVolume * this.volume, time);\r\n        clickEnv.gain.exponentialRampToValueAtTime(0.001, time + 0.01);\r\n\r\n        click.connect(clickEnv);\r\n        clickEnv.connect(this.audioContext.destination);\r\n\r\n        click.start(time);\r\n        click.stop(time + 0.02);\r\n    }\r\n\r\n    private playBeepSound(time: number, isAccent: boolean, isMainBeat: boolean) {\r\n        if (!this.audioContext) return;\r\n        const osc = this.audioContext.createOscillator();\r\n        const envelope = this.audioContext.createGain();\r\n\r\n        osc.type = 'sine';\r\n        osc.frequency.value = isAccent ? 1000.0 : 800.0;\r\n\r\n        const baseVolume = isMainBeat ? 1.0 : 0.5;\r\n        envelope.gain.setValueAtTime(0.5 * baseVolume * this.volume, time);\r\n        envelope.gain.exponentialRampToValueAtTime(0.001, time + 0.08);\r\n\r\n        osc.connect(envelope);\r\n        envelope.connect(this.audioContext.destination);\r\n\r\n        osc.start(time);\r\n        osc.stop(time + 0.1);\r\n    }\r\n\r\n    private scheduler() {\r\n        if (!this.audioContext) return;\r\n        while (this.nextNoteTime < this.audioContext.currentTime + this.scheduleAheadTime) {\r\n            this.scheduleNote(this.currentBeatInBar, this.currentSubdivision, this.nextNoteTime);\r\n            this.nextNote();\r\n        }\r\n        this.timerID = window.setTimeout(() => this.scheduler(), this.lookahead);\r\n    }\r\n\r\n    public start() {\r\n        if (this.isPlaying) return;\r\n\r\n        if (!this.audioContext) {\r\n            const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;\r\n            this.audioContext = new AudioContextClass();\r\n        }\r\n\r\n        const unlockAudio = (): Promise<void> => {\r\n            if (this.audioContext && this.audioContext.state === 'suspended') {\r\n                return this.audioContext.resume();\r\n            }\r\n            return Promise.resolve();\r\n        };\r\n\r\n        const warmupAudio = () => {\r\n            if (!this.audioContext) return;\r\n            const buffer = this.audioContext.createBuffer(1, 1, 22050);\r\n            const source = this.audioContext.createBufferSource();\r\n            source.buffer = buffer;\r\n            source.connect(this.audioContext.destination);\r\n            source.start(0);\r\n        };\r\n\r\n        unlockAudio()\r\n            .then(() => {\r\n                warmupAudio();\r\n                this._startPlayback();\r\n            })\r\n            .catch((err) => {\r\n                console.log('Audio unlock failed:', err);\r\n                this._startPlayback();\r\n            });\r\n    }\r\n\r\n    private _startPlayback() {\r\n        if (!this.audioContext) return;\r\n        this.isPlaying = true;\r\n        this.wakeLock.requestWakeLock();\r\n        this.currentBeatInBar = 0;\r\n        this.currentSubdivision = 0;\r\n        this.nextNoteTime = this.audioContext.currentTime + 0.1;\r\n        this.scheduler();\r\n    }\r\n\r\n    public stop() {\r\n        this.isPlaying = false;\r\n        this.wakeLock.releaseWakeLock();\r\n        if (this.timerID !== null) {\r\n            clearTimeout(this.timerID);\r\n            this.timerID = null;\r\n        }\r\n    }\r\n\r\n    public setTempo(bpm: number) {\r\n        this.tempo = bpm;\r\n    }\r\n\r\n    public setBeatsPerBar(beats: number) {\r\n        this.beatsPerBar = beats;\r\n    }\r\n\r\n    public setSoundType(type: 'click' | 'wood' | 'beep') {\r\n        this.soundType = type;\r\n    }\r\n\r\n    public setVolume(value: number) {\r\n        this.volume = value;\r\n    }\r\n\r\n    public setSubdivision(value: number) {\r\n        this.subdivision = value;\r\n    }\r\n\r\n    public setPendulumEnabled(enabled: boolean) {\r\n        this.pendulumEnabled = enabled;\r\n    }\r\n\r\n    private triggerPendulum() {\r\n        if (!this.pendulumEnabled) return;\r\n\r\n        if (this.pendulumDirection === 'left') {\r\n            this.pendulumDirection = 'right';\r\n        } else {\r\n            this.pendulumDirection = 'left';\r\n        }\r\n\r\n        if (this.pendulumCallback) {\r\n            this.pendulumCallback(this.pendulumDirection);\r\n        }\r\n    }\r\n}\r\n", "/**\r\n * TouchController - \u30BF\u30C3\u30C1\u64CD\u4F5C\u5236\u5FA1\r\n * \u30D4\u30F3\u30C1\u30BA\u30FC\u30E0\u3001\u30D0\u30A6\u30F3\u30B9\u3001\u30B9\u30EF\u30A4\u30D7\u306E\u5B8C\u5168\u7981\u6B62\r\n */\r\n\r\nimport { logAction, logWarn } from '../core/ActionLogger';\r\n\r\nexport class TouchController {\r\n    private static instance: TouchController | null = null;\r\n    private initialized = false;\r\n    private touchStartY = 0;\r\n\r\n    private constructor() { }\r\n\r\n    /**\r\n     * \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\r\n     */\r\n    static getInstance(): TouchController {\r\n        if (!TouchController.instance) {\r\n            TouchController.instance = new TouchController();\r\n        }\r\n        return TouchController.instance;\r\n    }\r\n\r\n    /**\r\n     * \u30BF\u30C3\u30C1\u5236\u5FA1\u3092\u521D\u671F\u5316\r\n     */\r\n    init(): void {\r\n        if (this.initialized) return;\r\n\r\n        // \u30D4\u30F3\u30C1\u30BA\u30FC\u30E0\u7981\u6B62\r\n        this.preventPinchZoom();\r\n\r\n        // \u30B8\u30A7\u30B9\u30C1\u30E3\u30FC\u7981\u6B62\uFF08iOS Safari\uFF09\r\n        this.preventGestures();\r\n\r\n        // \u30AA\u30FC\u30D0\u30FC\u30B9\u30AF\u30ED\u30FC\u30EB\uFF08\u30E9\u30D0\u30FC\u30D0\u30F3\u30C9\uFF09\u7981\u6B62\r\n        this.preventOverscroll();\r\n\r\n        // \u30C0\u30D6\u30EB\u30BF\u30C3\u30D7\u30BA\u30FC\u30E0\u7981\u6B62\r\n        this.preventDoubleTapZoom();\r\n\r\n        this.initialized = true;\r\n        logAction('touch_controller_initialized');\r\n    }\r\n\r\n    /**\r\n     * \u30D4\u30F3\u30C1\u30BA\u30FC\u30E0\u3092\u7981\u6B62\r\n     */\r\n    private preventPinchZoom(): void {\r\n        // touchstart: \u8907\u6570\u30BF\u30C3\u30C1\u306E\u691C\u51FA\r\n        document.addEventListener('touchstart', (e: TouchEvent) => {\r\n            if (e.touches.length > 1) {\r\n                e.preventDefault();\r\n                logWarn('pinch_attempt_blocked', { touchCount: e.touches.length });\r\n            }\r\n        }, { passive: false });\r\n\r\n        // touchmove: \u8907\u6570\u30BF\u30C3\u30C1\u4E2D\u306E\u79FB\u52D5\u3092\u7981\u6B62\r\n        document.addEventListener('touchmove', (e: TouchEvent) => {\r\n            if (e.touches.length > 1) {\r\n                e.preventDefault();\r\n            }\r\n        }, { passive: false });\r\n\r\n        // wheel: Ctrl+\u30DB\u30A4\u30FC\u30EB\u306B\u3088\u308B\u30BA\u30FC\u30E0\u3082\u7981\u6B62\uFF08\u30C7\u30B9\u30AF\u30C8\u30C3\u30D7\u5411\u3051\uFF09\r\n        document.addEventListener('wheel', (e: WheelEvent) => {\r\n            if (e.ctrlKey) {\r\n                e.preventDefault();\r\n                logWarn('ctrl_wheel_zoom_blocked');\r\n            }\r\n        }, { passive: false });\r\n    }\r\n\r\n    /**\r\n     * iOS Safari\u306E\u30B8\u30A7\u30B9\u30C1\u30E3\u30FC\u30A4\u30D9\u30F3\u30C8\u3092\u7981\u6B62\r\n     */\r\n    private preventGestures(): void {\r\n        document.addEventListener('gesturestart', (e: Event) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        document.addEventListener('gesturechange', (e: Event) => {\r\n            e.preventDefault();\r\n        });\r\n\r\n        document.addEventListener('gestureend', (e: Event) => {\r\n            e.preventDefault();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \u30AA\u30FC\u30D0\u30FC\u30B9\u30AF\u30ED\u30FC\u30EB\uFF08\u30E9\u30D0\u30FC\u30D0\u30F3\u30C9\uFF09\u3092\u7981\u6B62\r\n     */\r\n    private preventOverscroll(): void {\r\n        // body\u5168\u4F53\u306E\u30AA\u30FC\u30D0\u30FC\u30B9\u30AF\u30ED\u30FC\u30EB\u7981\u6B62\r\n        document.body.style.overscrollBehavior = 'none';\r\n        document.documentElement.style.overscrollBehavior = 'none';\r\n\r\n        // \u30E1\u30CB\u30E5\u30FC\u306E\u30AA\u30FC\u30D0\u30FC\u30B9\u30AF\u30ED\u30FC\u30EB\u5BFE\u7B56\r\n        const navMenu = document.getElementById('nav-menu');\r\n        const navOverlay = document.getElementById('nav-overlay');\r\n\r\n        if (navMenu) {\r\n            navMenu.style.overscrollBehavior = 'contain';\r\n\r\n            navMenu.addEventListener('touchstart', (e: TouchEvent) => {\r\n                this.touchStartY = e.touches[0].clientY;\r\n            }, { passive: true });\r\n\r\n            navMenu.addEventListener('touchmove', (e: TouchEvent) => {\r\n                const scrollable = navMenu.querySelector('.nav-list') as HTMLElement;\r\n\r\n                if (!scrollable) {\r\n                    e.preventDefault();\r\n                    return;\r\n                }\r\n\r\n                const currentY = e.touches[0].clientY;\r\n                const deltaY = currentY - this.touchStartY;\r\n                const atTop = scrollable.scrollTop <= 0;\r\n                const atBottom = scrollable.scrollTop + scrollable.clientHeight >= scrollable.scrollHeight;\r\n\r\n                // \u4E0A\u7AEF\u3067\u4E0A\u306B\u30B9\u30EF\u30A4\u30D7\u3001\u307E\u305F\u306F\u4E0B\u7AEF\u3067\u4E0B\u306B\u30B9\u30EF\u30A4\u30D7\u3092\u7981\u6B62\r\n                if ((atTop && deltaY > 0) || (atBottom && deltaY < 0)) {\r\n                    e.preventDefault();\r\n                }\r\n            }, { passive: false });\r\n        }\r\n\r\n        if (navOverlay) {\r\n            navOverlay.style.overscrollBehavior = 'none';\r\n\r\n            // \u30AA\u30FC\u30D0\u30FC\u30EC\u30A4\u81EA\u4F53\u306E\u30B9\u30AF\u30ED\u30FC\u30EB\u3092\u5B8C\u5168\u7981\u6B62\r\n            navOverlay.addEventListener('touchmove', (e: TouchEvent) => {\r\n                e.preventDefault();\r\n            }, { passive: false });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u30C0\u30D6\u30EB\u30BF\u30C3\u30D7\u30BA\u30FC\u30E0\u3092\u7981\u6B62\r\n     */\r\n    private preventDoubleTapZoom(): void {\r\n        let lastTouchEnd = 0;\r\n\r\n        document.addEventListener('touchend', (e: TouchEvent) => {\r\n            const now = Date.now();\r\n            if (now - lastTouchEnd <= 300) {\r\n                e.preventDefault();\r\n                logWarn('double_tap_zoom_blocked');\r\n            }\r\n            lastTouchEnd = now;\r\n        }, { passive: false });\r\n    }\r\n\r\n    /**\r\n     * \u7279\u5B9A\u306E\u8981\u7D20\u306B\u5BFE\u3057\u3066\u30B9\u30AF\u30ED\u30FC\u30EB\u3092\u8A31\u53EF\r\n     */\r\n    enableScrollingFor(element: HTMLElement): void {\r\n        element.style.touchAction = 'pan-y';\r\n        element.style.overscrollBehavior = 'contain';\r\n    }\r\n\r\n    /**\r\n     * \u7279\u5B9A\u306E\u8981\u7D20\u306B\u5BFE\u3057\u3066\u3059\u3079\u3066\u306E\u30BF\u30C3\u30C1\u64CD\u4F5C\u3092\u8A31\u53EF\r\n     */\r\n    enableAllTouchFor(element: HTMLElement): void {\r\n        element.style.touchAction = 'auto';\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30D3\u30E5\u30FC\u30DD\u30FC\u30C8\u72B6\u614B\u3092\u30EA\u30BB\u30C3\u30C8\r\n     * \u30BA\u30FC\u30E0\u304C\u4F55\u3089\u304B\u306E\u7406\u7531\u3067\u884C\u308F\u308C\u305F\u5834\u5408\u306E\u5FA9\u5E30\u7528\r\n     */\r\n    resetViewport(): void {\r\n        // Visual Viewport API\u3092\u4F7F\u7528\uFF08\u5BFE\u5FDC\u30D6\u30E9\u30A6\u30B6\u306E\u307F\uFF09\r\n        if (window.visualViewport) {\r\n            const viewport = window.visualViewport;\r\n\r\n            if (viewport.scale !== 1) {\r\n                logWarn('viewport_scale_reset', {\r\n                    previousScale: viewport.scale,\r\n                    previousOffsetLeft: viewport.offsetLeft,\r\n                    previousOffsetTop: viewport.offsetTop\r\n                });\r\n\r\n                // \u30B9\u30B1\u30FC\u30EB\u3092\u30EA\u30BB\u30C3\u30C8\uFF08\u9593\u63A5\u7684\u306B\uFF09\r\n                // \u6CE8: \u76F4\u63A5\u7684\u306A\u30EA\u30BB\u30C3\u30C8\u306F\u30BB\u30AD\u30E5\u30EA\u30C6\u30A3\u4E0A\u5236\u9650\u3055\u308C\u3066\u3044\u308B\r\n                window.scrollTo(0, 0);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u30D3\u30E5\u30FC\u30DD\u30FC\u30C8\u306E\u5909\u66F4\u3092\u76E3\u8996\r\n     */\r\n    watchViewport(callback: (scale: number) => void): () => void {\r\n        if (!window.visualViewport) {\r\n            return () => { };\r\n        }\r\n\r\n        const handler = () => {\r\n            callback(window.visualViewport!.scale);\r\n        };\r\n\r\n        window.visualViewport.addEventListener('resize', handler);\r\n\r\n        return () => {\r\n            window.visualViewport!.removeEventListener('resize', handler);\r\n        };\r\n    }\r\n}\r\n\r\n// \u4FBF\u5229\u306A\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\r\nexport function initTouchController(): void {\r\n    TouchController.getInstance().init();\r\n}\r\n", "/**\r\n * ThemeManager - \u30C6\u30FC\u30DE\u30FB\u52D5\u7684\u914D\u8272\u7BA1\u7406\r\n * \u80CC\u666F\u8272\u306E\u660E\u6697\u3092\u6570\u5B66\u7684\u306B\u8A08\u7B97\u3057\u3001\u67A0\u7DDA\u30FB\u6587\u5B57\u8272\u3092\u81EA\u52D5\u8ABF\u6574\r\n */\r\n\r\nimport { ThemeConfig, ThemeMode, STORAGE_KEYS } from '../types';\r\nimport { logAction } from '../core/ActionLogger';\r\n\r\nexport interface RGB {\r\n    r: number;\r\n    g: number;\r\n    b: number;\r\n}\r\n\r\nexport interface HSL {\r\n    h: number;\r\n    s: number;\r\n    l: number;\r\n}\r\n\r\nexport class ThemeManager {\r\n    private static instance: ThemeManager | null = null;\r\n    private currentTheme: ThemeConfig;\r\n    private currentMode: ThemeMode = 'dark';\r\n\r\n    private readonly DEFAULT_DARK_THEME: ThemeConfig = {\r\n        backgroundColor: '#0f0f1a',\r\n        borderColor: '#2a2a4a',\r\n        textColor: '#ffffff',\r\n        accentColor: '#8b5cf6'\r\n    };\r\n\r\n    private readonly DEFAULT_LIGHT_THEME: ThemeConfig = {\r\n        backgroundColor: '#f5f5f7',\r\n        borderColor: '#d1d1d6',\r\n        textColor: '#1d1d1f',\r\n        accentColor: '#7c3aed'\r\n    };\r\n\r\n    private constructor() {\r\n        this.currentTheme = this.DEFAULT_DARK_THEME;\r\n        this.loadFromStorage();\r\n    }\r\n\r\n    /**\r\n     * \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\r\n     */\r\n    static getInstance(): ThemeManager {\r\n        if (!ThemeManager.instance) {\r\n            ThemeManager.instance = new ThemeManager();\r\n        }\r\n        return ThemeManager.instance;\r\n    }\r\n\r\n    /**\r\n     * \u8272\u306E\u76F8\u5BFE\u8F1D\u5EA6\u3092\u8A08\u7B97\uFF08WCAG 2.1\u6E96\u62E0\uFF09\r\n     * \u4EBA\u9593\u306E\u77E5\u899A\u306B\u57FA\u3065\u3044\u305F\u91CD\u307F\u4ED8\u3051\r\n     */\r\n    getLuminance(hex: string): number {\r\n        const rgb = this.hexToRgb(hex);\r\n\r\n        // sRGB\u30EA\u30CB\u30A2\u5316\r\n        const r = this.linearize(rgb.r / 255);\r\n        const g = this.linearize(rgb.g / 255);\r\n        const b = this.linearize(rgb.b / 255);\r\n\r\n        // \u76F8\u5BFE\u8F1D\u5EA6\uFF080-1\uFF09\r\n        return 0.2126 * r + 0.7152 * g + 0.0722 * b;\r\n    }\r\n\r\n    /**\r\n     * \u7C21\u6613\u7684\u306A\u660E\u308B\u3055\u8A08\u7B97\uFF080-255\uFF09\r\n     */\r\n    getBrightness(hex: string): number {\r\n        const rgb = this.hexToRgb(hex);\r\n        return (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b);\r\n    }\r\n\r\n    /**\r\n     * 2\u8272\u9593\u306E\u30B3\u30F3\u30C8\u30E9\u30B9\u30C8\u6BD4\u3092\u8A08\u7B97\uFF08WCAG 2.1\u6E96\u62E0\uFF09\r\n     */\r\n    getContrastRatio(color1: string, color2: string): number {\r\n        const l1 = this.getLuminance(color1);\r\n        const l2 = this.getLuminance(color2);\r\n        const lighter = Math.max(l1, l2);\r\n        const darker = Math.min(l1, l2);\r\n        return (lighter + 0.05) / (darker + 0.05);\r\n    }\r\n\r\n    /**\r\n     * \u80CC\u666F\u8272\u304B\u3089\u9069\u5207\u306A\u67A0\u7DDA\u8272\u3092\u8A08\u7B97\r\n     */\r\n    calculateBorderColor(bgColor: string): string {\r\n        const brightness = this.getBrightness(bgColor);\r\n        const rgb = this.hexToRgb(bgColor);\r\n\r\n        if (brightness > 128) {\r\n            // \u660E\u308B\u3044\u80CC\u666F \u2192 \u6697\u3081\u306E\u67A0\u7DDA\r\n            return this.rgbToHex({\r\n                r: Math.max(0, Math.round(rgb.r * 0.85)),\r\n                g: Math.max(0, Math.round(rgb.g * 0.85)),\r\n                b: Math.max(0, Math.round(rgb.b * 0.85))\r\n            });\r\n        } else {\r\n            // \u6697\u3044\u80CC\u666F \u2192 \u660E\u308B\u3081\u306E\u67A0\u7DDA\r\n            return this.rgbToHex({\r\n                r: Math.min(255, Math.round(rgb.r + (255 - rgb.r) * 0.15)),\r\n                g: Math.min(255, Math.round(rgb.g + (255 - rgb.g) * 0.15)),\r\n                b: Math.min(255, Math.round(rgb.b + (255 - rgb.b) * 0.15))\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u80CC\u666F\u8272\u306B\u5BFE\u3059\u308B\u6700\u9069\u306A\u6587\u5B57\u8272\u3092\u81EA\u52D5\u9078\u629E\r\n     * WCAG 2.1 AA\u30EC\u30D9\u30EB\uFF08\u30B3\u30F3\u30C8\u30E9\u30B9\u30C8\u6BD44.5:1\u4EE5\u4E0A\uFF09\u3092\u4FDD\u8A3C\r\n     */\r\n    calculateTextColor(bgColor: string): string {\r\n        const brightness = this.getBrightness(bgColor);\r\n\r\n        // \u57FA\u672C\u7684\u306A\u767D/\u9ED2\u306E\u9078\u629E\r\n        const baseColor = brightness > 128 ? '#000000' : '#ffffff';\r\n\r\n        // \u30B3\u30F3\u30C8\u30E9\u30B9\u30C8\u6BD4\u306E\u78BA\u8A8D\r\n        const contrastRatio = this.getContrastRatio(bgColor, baseColor);\r\n\r\n        if (contrastRatio >= 4.5) {\r\n            return baseColor;\r\n        }\r\n\r\n        // \u30B3\u30F3\u30C8\u30E9\u30B9\u30C8\u304C\u4E0D\u5341\u5206\u306A\u5834\u5408\u306F\u8ABF\u6574\r\n        return brightness > 128 ? '#1a1a1a' : '#f0f0f0';\r\n    }\r\n\r\n    /**\r\n     * \u30A2\u30AF\u30BB\u30F3\u30C8\u30AB\u30E9\u30FC\u3092\u80CC\u666F\u306B\u5408\u308F\u305B\u3066\u8ABF\u6574\r\n     */\r\n    calculateAccentColor(bgColor: string, baseAccent: string): string {\r\n        const bgBrightness = this.getBrightness(bgColor);\r\n        const accentRgb = this.hexToRgb(baseAccent);\r\n        const accentHsl = this.rgbToHsl(accentRgb);\r\n\r\n        if (bgBrightness > 128) {\r\n            // \u660E\u308B\u3044\u80CC\u666F \u2192 \u30A2\u30AF\u30BB\u30F3\u30C8\u3092\u6697\u304F\r\n            accentHsl.l = Math.max(25, accentHsl.l - 15);\r\n        } else {\r\n            // \u6697\u3044\u80CC\u666F \u2192 \u30A2\u30AF\u30BB\u30F3\u30C8\u3092\u660E\u308B\u304F\r\n            accentHsl.l = Math.min(75, accentHsl.l + 10);\r\n        }\r\n\r\n        return this.hslToHex(accentHsl);\r\n    }\r\n\r\n    /**\r\n     * \u30C6\u30FC\u30DE\u30E2\u30FC\u30C9\u3092\u8A2D\u5B9A\r\n     */\r\n    setMode(mode: ThemeMode): void {\r\n        this.currentMode = mode;\r\n        this.currentTheme = mode === 'dark'\r\n            ? { ...this.DEFAULT_DARK_THEME }\r\n            : { ...this.DEFAULT_LIGHT_THEME };\r\n\r\n        this.applyTheme();\r\n        this.saveToStorage();\r\n        logAction('theme_mode_changed', { mode });\r\n    }\r\n\r\n    /**\r\n     * UI\u8981\u7D20\u3068\u306E\u30D0\u30A4\u30F3\u30C7\u30A3\u30F3\u30B0\u3092\u521D\u671F\u5316\r\n     */\r\n    initUI(): void {\r\n        const themeSelect = document.getElementById('theme-select') as HTMLSelectElement;\r\n        if (themeSelect) {\r\n            // \u521D\u671F\u5024\u3092UI\u306B\u53CD\u6620\r\n            themeSelect.value = this.currentMode;\r\n\r\n            // \u5909\u66F4\u30A4\u30D9\u30F3\u30C8\u3092\u76E3\u8996\r\n            themeSelect.addEventListener('change', (e) => {\r\n                this.setMode((e.target as HTMLSelectElement).value as ThemeMode);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u80CC\u666F\u8272\u3092\u30AB\u30B9\u30BF\u30E0\u8A2D\u5B9A\u3057\u3001\u4ED6\u306E\u8272\u3092\u81EA\u52D5\u8A08\u7B97\r\n     */\r\n    setBackgroundColor(bgColor: string): void {\r\n        this.currentTheme = {\r\n            backgroundColor: bgColor,\r\n            borderColor: this.calculateBorderColor(bgColor),\r\n            textColor: this.calculateTextColor(bgColor),\r\n            accentColor: this.calculateAccentColor(bgColor, this.currentTheme.accentColor)\r\n        };\r\n\r\n        this.applyTheme();\r\n        this.saveToStorage();\r\n        logAction('background_color_changed', { bgColor, theme: this.currentTheme });\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30C6\u30FC\u30DE\u3092DOM\u306B\u9069\u7528\r\n     */\r\n    applyTheme(): void {\r\n        const root = document.documentElement;\r\n\r\n        root.style.setProperty('--bg-color', this.currentTheme.backgroundColor);\r\n        root.style.setProperty('--border-color', this.currentTheme.borderColor);\r\n        root.style.setProperty('--text-color', this.currentTheme.textColor);\r\n        root.style.setProperty('--accent-color', this.currentTheme.accentColor);\r\n\r\n        // data-theme\u5C5E\u6027\u3082\u8A2D\u5B9A\r\n        root.setAttribute('data-theme', this.currentMode);\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30C6\u30FC\u30DE\u8A2D\u5B9A\u3092\u53D6\u5F97\r\n     */\r\n    getTheme(): ThemeConfig {\r\n        return { ...this.currentTheme };\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30E2\u30FC\u30C9\u3092\u53D6\u5F97\r\n     */\r\n    getMode(): ThemeMode {\r\n        return this.currentMode;\r\n    }\r\n\r\n    /**\r\n     * \u30B9\u30C8\u30EC\u30FC\u30B8\u306B\u4FDD\u5B58\r\n     */\r\n    private saveToStorage(): void {\r\n        try {\r\n            const data = {\r\n                theme: this.currentTheme,\r\n                mode: this.currentMode\r\n            };\r\n            localStorage.setItem(STORAGE_KEYS.THEME, JSON.stringify(data));\r\n        } catch (e) {\r\n            console.warn('Failed to save theme:', e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * \u30B9\u30C8\u30EC\u30FC\u30B8\u304B\u3089\u8AAD\u307F\u8FBC\u307F\r\n     */\r\n    private loadFromStorage(): void {\r\n        try {\r\n            const saved = localStorage.getItem(STORAGE_KEYS.THEME);\r\n            if (saved) {\r\n                const data = JSON.parse(saved);\r\n                if (data.theme) this.currentTheme = data.theme;\r\n                if (data.mode) this.currentMode = data.mode;\r\n                this.applyTheme();\r\n            }\r\n        } catch (e) {\r\n            console.warn('Failed to load theme:', e);\r\n        }\r\n    }\r\n\r\n    // ========================================\r\n    // \u30E6\u30FC\u30C6\u30A3\u30EA\u30C6\u30A3\u95A2\u6570\r\n    // ========================================\r\n\r\n    private hexToRgb(hex: string): RGB {\r\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        return result ? {\r\n            r: parseInt(result[1], 16),\r\n            g: parseInt(result[2], 16),\r\n            b: parseInt(result[3], 16)\r\n        } : { r: 0, g: 0, b: 0 };\r\n    }\r\n\r\n    private rgbToHex(rgb: RGB): string {\r\n        return '#' + [rgb.r, rgb.g, rgb.b]\r\n            .map(x => Math.round(Math.max(0, Math.min(255, x))).toString(16).padStart(2, '0'))\r\n            .join('');\r\n    }\r\n\r\n    private rgbToHsl(rgb: RGB): HSL {\r\n        const r = rgb.r / 255;\r\n        const g = rgb.g / 255;\r\n        const b = rgb.b / 255;\r\n\r\n        const max = Math.max(r, g, b);\r\n        const min = Math.min(r, g, b);\r\n        let h = 0;\r\n        let s = 0;\r\n        const l = (max + min) / 2;\r\n\r\n        if (max !== min) {\r\n            const d = max - min;\r\n            s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\r\n\r\n            switch (max) {\r\n                case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;\r\n                case g: h = ((b - r) / d + 2) / 6; break;\r\n                case b: h = ((r - g) / d + 4) / 6; break;\r\n            }\r\n        }\r\n\r\n        return { h: h * 360, s: s * 100, l: l * 100 };\r\n    }\r\n\r\n    private hslToHex(hsl: HSL): string {\r\n        const h = hsl.h / 360;\r\n        const s = hsl.s / 100;\r\n        const l = hsl.l / 100;\r\n\r\n        let r: number, g: number, b: number;\r\n\r\n        if (s === 0) {\r\n            r = g = b = l;\r\n        } else {\r\n            const hue2rgb = (p: number, q: number, t: number): number => {\r\n                if (t < 0) t += 1;\r\n                if (t > 1) t -= 1;\r\n                if (t < 1 / 6) return p + (q - p) * 6 * t;\r\n                if (t < 1 / 2) return q;\r\n                if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\r\n                return p;\r\n            };\r\n\r\n            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;\r\n            const p = 2 * l - q;\r\n            r = hue2rgb(p, q, h + 1 / 3);\r\n            g = hue2rgb(p, q, h);\r\n            b = hue2rgb(p, q, h - 1 / 3);\r\n        }\r\n\r\n        return this.rgbToHex({\r\n            r: Math.round(r * 255),\r\n            g: Math.round(g * 255),\r\n            b: Math.round(b * 255)\r\n        });\r\n    }\r\n\r\n    private linearize(value: number): number {\r\n        return value <= 0.03928\r\n            ? value / 12.92\r\n            : Math.pow((value + 0.055) / 1.055, 2.4);\r\n    }\r\n}\r\n\r\n// \u4FBF\u5229\u306A\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\r\nexport function setThemeMode(mode: ThemeMode): void {\r\n    ThemeManager.getInstance().setMode(mode);\r\n}\r\n\r\nexport function setBackgroundColor(color: string): void {\r\n    ThemeManager.getInstance().setBackgroundColor(color);\r\n}\r\n", "/**\r\n * DataManager - \u30C7\u30FC\u30BF\u6D88\u53BB\u7BA1\u7406\r\n * 3\u79D2\u9577\u62BC\u3057\u3067\u5B8C\u5168\u6D88\u53BB\u3001\u30D7\u30ED\u30B0\u30EC\u30B9\u8868\u793A\u4ED8\u304D\r\n */\r\n\r\nimport { STORAGE_KEYS } from '../types';\r\nimport { logAction, logWarn } from '../core/ActionLogger';\r\nimport { DeviceIdentifier } from '../core/DeviceIdentifier';\r\n\r\nexport interface DeleteProgress {\r\n    isHolding: boolean;\r\n    progress: number; // 0-100\r\n    startTime: number | null;\r\n}\r\n\r\nexport class DataManager {\r\n    private static instance: DataManager | null = null;\r\n    private readonly HOLD_DURATION = 3000; // 3\u79D2\r\n    private holdStartTime: number | null = null;\r\n    private progressTimer: number | null = null;\r\n    private animationFrame: number | null = null;\r\n    private onProgressChange: ((progress: number) => void) | null = null;\r\n    private onDeleteComplete: (() => void) | null = null;\r\n\r\n    private constructor() { }\r\n\r\n    /**\r\n     * \u30B7\u30F3\u30B0\u30EB\u30C8\u30F3\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u53D6\u5F97\r\n     */\r\n    static getInstance(): DataManager {\r\n        if (!DataManager.instance) {\r\n            DataManager.instance = new DataManager();\r\n        }\r\n        return DataManager.instance;\r\n    }\r\n\r\n    /**\r\n     * \u9577\u62BC\u3057\u524A\u9664\u30DC\u30BF\u30F3\u3092\u521D\u671F\u5316\r\n     */\r\n    initDeleteButton(\r\n        buttonId: string,\r\n        progressId: string,\r\n        options?: {\r\n            onProgress?: (progress: number) => void;\r\n            onComplete?: () => void;\r\n        }\r\n    ): void {\r\n        const button = document.getElementById(buttonId);\r\n        const progress = document.getElementById(progressId);\r\n\r\n        if (!button) {\r\n            logWarn('delete_button_not_found', { buttonId });\r\n            return;\r\n        }\r\n\r\n        this.onProgressChange = options?.onProgress || null;\r\n        this.onDeleteComplete = options?.onComplete || null;\r\n\r\n        // \u30BF\u30C3\u30C1\u30A4\u30D9\u30F3\u30C8\r\n        button.addEventListener('touchstart', (e) => {\r\n            e.preventDefault();\r\n            this.startHold(progress);\r\n        }, { passive: false });\r\n\r\n        button.addEventListener('touchend', () => this.cancelHold(progress));\r\n        button.addEventListener('touchcancel', () => this.cancelHold(progress));\r\n\r\n        // \u30DE\u30A6\u30B9\u30A4\u30D9\u30F3\u30C8\r\n        button.addEventListener('mousedown', () => this.startHold(progress));\r\n        button.addEventListener('mouseup', () => this.cancelHold(progress));\r\n        button.addEventListener('mouseleave', () => this.cancelHold(progress));\r\n\r\n        logAction('delete_button_initialized', { buttonId, progressId });\r\n    }\r\n\r\n    /**\r\n     * \u9577\u62BC\u3057\u958B\u59CB\r\n     */\r\n    private startHold(progressElement: HTMLElement | null): void {\r\n        this.holdStartTime = Date.now();\r\n\r\n        logAction('delete_hold_started');\r\n\r\n        // \u30D7\u30ED\u30B0\u30EC\u30B9\u30A2\u30CB\u30E1\u30FC\u30B7\u30E7\u30F3\u958B\u59CB\r\n        if (progressElement) {\r\n            progressElement.style.transition = 'none';\r\n            progressElement.style.width = '0%';\r\n\r\n            // \u5F37\u5236\u30EA\u30D5\u30ED\u30FC\r\n            void progressElement.offsetWidth;\r\n\r\n            progressElement.style.transition = `width ${this.HOLD_DURATION}ms linear`;\r\n            progressElement.style.width = '100%';\r\n        }\r\n\r\n        // \u30D7\u30ED\u30B0\u30EC\u30B9\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u7528\u306E\u30A2\u30CB\u30E1\u30FC\u30B7\u30E7\u30F3\u30D5\u30EC\u30FC\u30E0\r\n        const updateProgress = () => {\r\n            if (this.holdStartTime === null) return;\r\n\r\n            const elapsed = Date.now() - this.holdStartTime;\r\n            const progress = Math.min((elapsed / this.HOLD_DURATION) * 100, 100);\r\n\r\n            if (this.onProgressChange) {\r\n                this.onProgressChange(progress);\r\n            }\r\n\r\n            if (progress < 100) {\r\n                this.animationFrame = requestAnimationFrame(updateProgress);\r\n            }\r\n        };\r\n\r\n        this.animationFrame = requestAnimationFrame(updateProgress);\r\n\r\n        // \u30BF\u30A4\u30E0\u30A2\u30A6\u30C8\u8A2D\u5B9A\r\n        this.progressTimer = window.setTimeout(() => {\r\n            this.executeDelete();\r\n        }, this.HOLD_DURATION);\r\n    }\r\n\r\n    /**\r\n     * \u9577\u62BC\u3057\u30AD\u30E3\u30F3\u30BB\u30EB\r\n     */\r\n    private cancelHold(progressElement: HTMLElement | null): void {\r\n        if (this.holdStartTime === null) return;\r\n\r\n        const elapsed = Date.now() - this.holdStartTime;\r\n        logAction('delete_hold_cancelled', { elapsed, percentage: (elapsed / this.HOLD_DURATION) * 100 });\r\n\r\n        // \u30BF\u30A4\u30DE\u30FC\u3092\u30AF\u30EA\u30A2\r\n        if (this.progressTimer) {\r\n            clearTimeout(this.progressTimer);\r\n            this.progressTimer = null;\r\n        }\r\n\r\n        if (this.animationFrame) {\r\n            cancelAnimationFrame(this.animationFrame);\r\n            this.animationFrame = null;\r\n        }\r\n\r\n        // \u30D7\u30ED\u30B0\u30EC\u30B9\u3092\u30EA\u30BB\u30C3\u30C8\r\n        if (progressElement) {\r\n            progressElement.style.transition = 'width 0.2s ease';\r\n            progressElement.style.width = '0%';\r\n        }\r\n\r\n        if (this.onProgressChange) {\r\n            this.onProgressChange(0);\r\n        }\r\n\r\n        this.holdStartTime = null;\r\n    }\r\n\r\n    /**\r\n     * \u5B8C\u5168\u6D88\u53BB\u306E\u5B9F\u884C\r\n     */\r\n    private executeDelete(): void {\r\n        logAction('delete_executed');\r\n\r\n        // \u3059\u3079\u3066\u306E\u30A2\u30D7\u30EA\u30C7\u30FC\u30BF\u3092\u6D88\u53BB\r\n        const keysToDelete = Object.values(STORAGE_KEYS);\r\n\r\n        keysToDelete.forEach(key => {\r\n            try {\r\n                localStorage.removeItem(key);\r\n            } catch (e) {\r\n                console.warn(`Failed to remove ${key}:`, e);\r\n            }\r\n        });\r\n\r\n        // \u30C7\u30D0\u30A4\u30B9ID\u3092\u518D\u751F\u6210\uFF08\u5B8C\u5168\u306A\u521D\u671F\u5316\uFF09\r\n        DeviceIdentifier.getInstance().regenerate();\r\n\r\n        // \u5B8C\u4E86\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\r\n        if (this.onDeleteComplete) {\r\n            this.onDeleteComplete();\r\n        }\r\n\r\n        // \u30A2\u30D7\u30EA\u3092\u30EA\u30ED\u30FC\u30C9\u3057\u3066\u521D\u671F\u72B6\u614B\u306B\u623B\u3059\r\n        window.location.reload();\r\n    }\r\n\r\n    /**\r\n     * \u7279\u5B9A\u306E\u30C7\u30FC\u30BF\u306E\u307F\u3092\u524A\u9664\r\n     */\r\n    deleteSpecific(keys: (keyof typeof STORAGE_KEYS)[]): void {\r\n        keys.forEach(key => {\r\n            const storageKey = STORAGE_KEYS[key];\r\n            try {\r\n                localStorage.removeItem(storageKey);\r\n                logAction('specific_data_deleted', { key: storageKey });\r\n            } catch (e) {\r\n                logWarn('delete_failed', { key: storageKey, error: String(e) });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * \u73FE\u5728\u306E\u30B9\u30C8\u30EC\u30FC\u30B8\u4F7F\u7528\u91CF\u3092\u53D6\u5F97\r\n     */\r\n    getStorageUsage(): {\r\n        used: number;\r\n        available: number;\r\n        items: { key: string; size: number }[];\r\n    } {\r\n        const items: { key: string; size: number }[] = [];\r\n        let totalUsed = 0;\r\n\r\n        Object.values(STORAGE_KEYS).forEach(key => {\r\n            try {\r\n                const value = localStorage.getItem(key);\r\n                if (value) {\r\n                    const size = new Blob([value]).size;\r\n                    items.push({ key, size });\r\n                    totalUsed += size;\r\n                }\r\n            } catch (e) {\r\n                // \u7121\u8996\r\n            }\r\n        });\r\n\r\n        return {\r\n            used: totalUsed,\r\n            available: 5 * 1024 * 1024 - totalUsed, // \u4E00\u822C\u7684\u306AlocalStorage\u306E\u5236\u9650\u306F5MB\r\n            items\r\n        };\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30FC\u30BF\u306E\u30A8\u30AF\u30B9\u30DD\u30FC\u30C8\r\n     */\r\n    exportAllData(): string {\r\n        const data: Record<string, unknown> = {};\r\n\r\n        Object.entries(STORAGE_KEYS).forEach(([name, key]) => {\r\n            try {\r\n                const value = localStorage.getItem(key);\r\n                if (value) {\r\n                    try {\r\n                        data[name] = JSON.parse(value);\r\n                    } catch {\r\n                        data[name] = value;\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                // \u7121\u8996\r\n            }\r\n        });\r\n\r\n        return JSON.stringify({\r\n            exportedAt: new Date().toISOString(),\r\n            deviceId: DeviceIdentifier.getInstance().getId(),\r\n            data\r\n        }, null, 2);\r\n    }\r\n\r\n    /**\r\n     * \u30C7\u30FC\u30BF\u306E\u30A4\u30F3\u30DD\u30FC\u30C8\r\n     */\r\n    importData(jsonString: string): boolean {\r\n        try {\r\n            const imported = JSON.parse(jsonString);\r\n\r\n            if (!imported.data) {\r\n                logWarn('import_failed', { reason: 'No data field' });\r\n                return false;\r\n            }\r\n\r\n            Object.entries(imported.data).forEach(([name, value]) => {\r\n                const key = STORAGE_KEYS[name as keyof typeof STORAGE_KEYS];\r\n                if (key) {\r\n                    localStorage.setItem(key, JSON.stringify(value));\r\n                }\r\n            });\r\n\r\n            logAction('data_imported', { itemCount: Object.keys(imported.data).length });\r\n            return true;\r\n        } catch (e) {\r\n            logWarn('import_failed', { error: String(e) });\r\n            return false;\r\n        }\r\n    }\r\n}\r\n\r\n// \u4FBF\u5229\u306A\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\r\nexport function initDataManager(buttonId: string, progressId: string): void {\r\n    DataManager.getInstance().initDeleteButton(buttonId, progressId);\r\n}\r\n\r\nexport function exportAppData(): string {\r\n    return DataManager.getInstance().exportAllData();\r\n}\r\n", "import { calculateTempoPracticeTime, formatTime, PracticeParams, CalculationResult } from '../core/Calculator';\r\n\r\nexport class CalculatorUI {\r\n    private form: HTMLFormElement | null = null;\r\n    private resultsSection: HTMLElement | null = null;\r\n\r\n    // Result elements\r\n    private totalTimeDisplay: HTMLElement | null = null;\r\n    private totalTimeSecondsDisplay: HTMLElement | null = null;\r\n    private actualEndTempoDisplay: HTMLElement | null = null;\r\n    private exactTimeDisplay: HTMLElement | null = null;\r\n    private approxTimeDisplay: HTMLElement | null = null;\r\n    private errorRateDisplay: HTMLElement | null = null;\r\n    private totalBeatsPerStepDisplay: HTMLElement | null = null;\r\n\r\n    constructor() { }\r\n\r\n    public init() {\r\n        this.form = document.getElementById('calculator-form') as HTMLFormElement;\r\n        this.resultsSection = document.getElementById('results-section');\r\n\r\n        this.totalTimeDisplay = document.getElementById('totalTime');\r\n        this.totalTimeSecondsDisplay = document.getElementById('totalTimeSeconds');\r\n        this.actualEndTempoDisplay = document.getElementById('actualEndTempo');\r\n        this.exactTimeDisplay = document.getElementById('exactTime');\r\n        this.approxTimeDisplay = document.getElementById('approxTime');\r\n        this.errorRateDisplay = document.getElementById('errorRate');\r\n        this.totalBeatsPerStepDisplay = document.getElementById('totalBeatsPerStep');\r\n\r\n        if (this.form) {\r\n            this.form.addEventListener('submit', this.handleSubmit.bind(this));\r\n            this.setupValidation();\r\n        }\r\n\r\n        this.setupKeyboardShortcuts();\r\n    }\r\n\r\n    private handleSubmit(e: Event) {\r\n        e.preventDefault();\r\n\r\n        if (!this.form) return;\r\n\r\n        const formData = new FormData(this.form);\r\n        const params: PracticeParams = {\r\n            a: parseFloat(formData.get('startTempo') as string),\r\n            b: parseFloat(formData.get('endTempo') as string),\r\n            s: 1, // \u30CF\u30FC\u30C9\u30B3\u30FC\u30C9: \u30B9\u30C6\u30C3\u30D7\u5E451\r\n            B: parseInt(formData.get('beatsPerPhrase') as string, 10),\r\n            R: parseInt(formData.get('repetitions') as string, 10),\r\n            N: 1 // \u30CF\u30FC\u30C9\u30B3\u30FC\u30C9: 1\u30BB\u30C3\u30C8\r\n        };\r\n\r\n        try {\r\n            const result = calculateTempoPracticeTime(params);\r\n            this.displayResults(result);\r\n            console.log('\u8A08\u7B97\u7D50\u679C:', result);\r\n        } catch (error: any) {\r\n            this.showError(error.message || '\u8A08\u7B97\u30A8\u30E9\u30FC');\r\n            console.error('\u8A08\u7B97\u30A8\u30E9\u30FC:', error);\r\n        }\r\n    }\r\n\r\n    private setupValidation() {\r\n        if (!this.form) return;\r\n        const inputs = this.form.querySelectorAll('input[type=\"number\"]');\r\n\r\n        inputs.forEach(input => {\r\n            input.addEventListener('input', function (this: HTMLInputElement) {\r\n                const min = parseFloat(this.min);\r\n                const max = parseFloat(this.max);\r\n                let value = parseFloat(this.value);\r\n\r\n                if (value < min || value > max) {\r\n                    this.style.borderColor = 'rgba(239, 68, 68, 0.5)';\r\n                } else {\r\n                    this.style.borderColor = '';\r\n                }\r\n            });\r\n\r\n            input.addEventListener('focus', function (this: HTMLInputElement) {\r\n                this.select();\r\n            });\r\n        });\r\n    }\r\n\r\n    private setupKeyboardShortcuts() {\r\n        document.addEventListener('keydown', (e) => {\r\n            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {\r\n                e.preventDefault();\r\n                if (this.form) {\r\n                    this.form.dispatchEvent(new Event('submit'));\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private displayResults(result: CalculationResult) {\r\n        if (!this.resultsSection) return;\r\n\r\n        const { exactSeconds, approxSeconds, errorRate } = result.results;\r\n        const { actualEndTempo, totalBeatsPerStep } = result.metadata;\r\n\r\n        // Animate numbers for polished feel (Slot machine effect)\r\n        this.animateNumber(this.totalTimeDisplay, exactSeconds, formatTime);\r\n        this.animateNumber(this.totalTimeSecondsDisplay, exactSeconds, (v) => v.toFixed(1) + ' \u79D2');\r\n\r\n        // Update details\r\n        if (this.actualEndTempoDisplay) this.actualEndTempoDisplay.textContent = `${actualEndTempo} BPM`;\r\n        if (this.exactTimeDisplay) this.exactTimeDisplay.textContent = `${exactSeconds.toFixed(3)} \u79D2`;\r\n        if (this.approxTimeDisplay) this.approxTimeDisplay.textContent = `${approxSeconds.toFixed(3)} \u79D2`;\r\n\r\n        if (this.errorRateDisplay) {\r\n            const isNegative = errorRate < 0;\r\n            const sign = isNegative ? '' : '+';\r\n            this.errorRateDisplay.textContent = `${sign}${errorRate.toExponential(2)} %`;\r\n            this.errorRateDisplay.style.color = Math.abs(errorRate) < 0.01 ? 'var(--color-tertiary)' : 'var(--color-text-secondary)';\r\n        }\r\n\r\n        if (this.totalBeatsPerStepDisplay) this.totalBeatsPerStepDisplay.textContent = `${totalBeatsPerStep} \u62CD`;\r\n\r\n        // Show results section if hidden\r\n        this.resultsSection.classList.remove('hidden');\r\n\r\n        // Highlight effect\r\n        const totalTimeCard = document.querySelector('.result-card.primary') as HTMLElement;\r\n        if (totalTimeCard) {\r\n            totalTimeCard.style.transform = 'scale(1.02)';\r\n            totalTimeCard.style.boxShadow = '0 0 30px rgba(99, 102, 241, 0.3)';\r\n            setTimeout(() => {\r\n                totalTimeCard.style.transform = '';\r\n                totalTimeCard.style.boxShadow = '';\r\n            }, 300);\r\n        }\r\n    }\r\n\r\n    private showError(message: string) {\r\n        if (!this.resultsSection) return;\r\n\r\n        this.resultsSection.classList.remove('hidden');\r\n        this.resultsSection.innerHTML = `\r\n            <div class=\"error-message\" style=\"\r\n                background: rgba(239, 68, 68, 0.1);\r\n                border: 1px solid rgba(239, 68, 68, 0.3);\r\n                color: #fca5a5;\r\n                padding: var(--space-lg);\r\n                border-radius: var(--radius-md);\r\n                text-align: center;\r\n            \">\r\n                <span style=\"font-size: var(--font-size-xl); display: block; margin-bottom: var(--space-sm);\">\u26A0\uFE0F</span>\r\n                ${message}\r\n            </div>\r\n        `;\r\n\r\n        // Restore original HTML after 3 seconds so they can calculate again\r\n        setTimeout(() => {\r\n            window.location.reload();\r\n        }, 3000);\r\n    }\r\n\r\n    private animateNumber(element: HTMLElement | null, targetValue: number, formatter: (val: number) => string) {\r\n        if (!element) return;\r\n\r\n        element.style.opacity = '0';\r\n        element.style.transform = 'translateY(-10px)';\r\n        element.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';\r\n\r\n        // Reset text\r\n        element.textContent = formatter(0);\r\n\r\n        setTimeout(() => {\r\n            element.style.opacity = '1';\r\n            element.style.transform = 'translateY(0)';\r\n\r\n            const duration = 800; // 800ms animation\r\n            const startTime = performance.now();\r\n\r\n            const updateNumber = (currentTime: number) => {\r\n                const elapsed = currentTime - startTime;\r\n                const progress = Math.min(elapsed / duration, 1);\r\n\r\n                // Ease out expo (fast start, slow end)\r\n                const easeOut = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);\r\n\r\n                const currentValue = targetValue * easeOut;\r\n                element.textContent = formatter(currentValue);\r\n\r\n                if (progress < 1) {\r\n                    requestAnimationFrame(updateNumber);\r\n                } else {\r\n                    element.textContent = formatter(targetValue); // Ensure precise final value\r\n                }\r\n            };\r\n\r\n            requestAnimationFrame(updateNumber);\r\n        }, 50);\r\n    }\r\n}\r\n", "import { Metronome } from '../core/Metronome';\r\n\r\nexport class MetronomeUI {\r\n    private metronome: Metronome;\r\n\r\n    // UI Elements\r\n    private bpmDisplay: HTMLElement | null = null;\r\n    private bpmSlider: HTMLInputElement | null = null;\r\n    private playBtn: HTMLElement | null = null;\r\n    private visualCircle: HTMLElement | null = null;\r\n\r\n    constructor() {\r\n        this.metronome = new Metronome();\r\n    }\r\n\r\n    public init() {\r\n        this.bpmDisplay = document.getElementById('bpm-display');\r\n        this.bpmSlider = document.getElementById('bpm-slider') as HTMLInputElement;\r\n        const bpmIncrease = document.getElementById('bpm-increase');\r\n        const bpmDecrease = document.getElementById('bpm-decrease');\r\n        this.playBtn = document.getElementById('metronome-play-btn');\r\n        const tapBtn = document.getElementById('tap-tempo-btn');\r\n        const timeSignatureSelect = document.getElementById('time-signature-select') as HTMLSelectElement;\r\n        const subdivisionSelect = document.getElementById('subdivision-select') as HTMLSelectElement;\r\n        const soundSelect = document.getElementById('sound-select') as HTMLSelectElement;\r\n        const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\r\n        const pendulumToggle = document.getElementById('pendulum-toggle') as HTMLInputElement;\r\n\r\n        this.visualCircle = document.getElementById('visual-circle');\r\n        const pendulumArm = document.getElementById('pendulum-arm');\r\n\r\n        if (!this.bpmDisplay || !this.bpmSlider || !this.playBtn) {\r\n            console.error('Metronome elements not found');\r\n            return;\r\n        }\r\n\r\n        // Callbacks for visual feedback\r\n        this.metronome.setVisualCallback((beatNumber, isMainBeat, isAccent) => {\r\n            if (!this.visualCircle) return;\r\n            this.visualCircle.className = 'visual-circle'; // reset\r\n            void this.visualCircle.offsetWidth; // force reflow\r\n\r\n            if (isAccent) {\r\n                this.visualCircle.classList.add('accent');\r\n            } else if (isMainBeat) {\r\n                this.visualCircle.classList.add('beat');\r\n            } else {\r\n                this.visualCircle.classList.add('sub-beat');\r\n            }\r\n\r\n            setTimeout(() => {\r\n                if (this.visualCircle) {\r\n                    this.visualCircle.classList.remove('beat', 'accent', 'sub-beat');\r\n                }\r\n            }, 100);\r\n        });\r\n\r\n        this.metronome.setPendulumCallback((direction) => {\r\n            if (!pendulumArm) return;\r\n            pendulumArm.classList.remove('swinging-left', 'swinging-right');\r\n            void pendulumArm.offsetWidth;\r\n\r\n            if (direction === 'right') {\r\n                pendulumArm.classList.add('swinging-right');\r\n            } else {\r\n                pendulumArm.classList.add('swinging-left');\r\n            }\r\n        });\r\n\r\n        // Initialize values\r\n        this.updateTempo(120);\r\n\r\n        if (timeSignatureSelect) {\r\n            this.metronome.setBeatsPerBar(parseInt(timeSignatureSelect.value, 10));\r\n            timeSignatureSelect.addEventListener('change', (e) => {\r\n                this.metronome.setBeatsPerBar(parseInt((e.target as HTMLSelectElement).value, 10));\r\n            });\r\n        }\r\n\r\n        if (subdivisionSelect) {\r\n            this.metronome.setSubdivision(parseInt(subdivisionSelect.value, 10));\r\n            subdivisionSelect.addEventListener('change', (e) => {\r\n                this.metronome.setSubdivision(parseInt((e.target as HTMLSelectElement).value, 10));\r\n            });\r\n        }\r\n\r\n        if (soundSelect) {\r\n            this.metronome.setSoundType(soundSelect.value as any);\r\n            soundSelect.addEventListener('change', (e) => {\r\n                this.metronome.setSoundType((e.target as HTMLSelectElement).value as any);\r\n            });\r\n        }\r\n\r\n        if (volumeSlider) {\r\n            this.metronome.setVolume(parseFloat(volumeSlider.value));\r\n            volumeSlider.addEventListener('input', (e) => {\r\n                this.metronome.setVolume(parseFloat((e.target as HTMLInputElement).value));\r\n            });\r\n        }\r\n\r\n        if (pendulumToggle) {\r\n            this.metronome.setPendulumEnabled(pendulumToggle.checked);\r\n            pendulumToggle.addEventListener('change', (e) => {\r\n                this.metronome.setPendulumEnabled((e.target as HTMLInputElement).checked);\r\n            });\r\n        }\r\n\r\n        // Tempo Change Handlers\r\n        this.bpmSlider.addEventListener('input', (e) => {\r\n            this.updateTempo(parseInt((e.target as HTMLInputElement).value, 10));\r\n        });\r\n\r\n        if (bpmDecrease) {\r\n            bpmDecrease.addEventListener('click', () => {\r\n                if (this.bpmSlider) {\r\n                    this.updateTempo(parseInt(this.bpmSlider.value, 10) - 1);\r\n                }\r\n            });\r\n        }\r\n\r\n        if (bpmIncrease) {\r\n            bpmIncrease.addEventListener('click', () => {\r\n                if (this.bpmSlider) {\r\n                    this.updateTempo(parseInt(this.bpmSlider.value, 10) + 1);\r\n                }\r\n            });\r\n        }\r\n\r\n        // Play/Pause\r\n        this.playBtn.addEventListener('click', () => {\r\n            if (this.metronome.isPlaying) {\r\n                this.metronome.stop();\r\n                this.playBtn?.classList.remove('playing');\r\n                if (pendulumArm) {\r\n                    pendulumArm.classList.remove('swinging-left', 'swinging-right');\r\n                }\r\n            } else {\r\n                this.metronome.start();\r\n                this.playBtn?.classList.add('playing');\r\n            }\r\n        });\r\n\r\n        // Tap Tempo Logic\r\n        if (tapBtn) {\r\n            this.setupTapTempo(tapBtn);\r\n        }\r\n\r\n        // Settings Modal\r\n        this.setupSettingsModal();\r\n    }\r\n\r\n    private updateTempo(bpm: number) {\r\n        let newBpm = Math.min(Math.max(bpm, 30), 250); // Clamp 30-250\r\n        if (this.bpmDisplay) this.bpmDisplay.textContent = newBpm.toString();\r\n        if (this.bpmSlider) this.bpmSlider.value = newBpm.toString();\r\n        this.metronome.setTempo(newBpm);\r\n\r\n        const tempoText = document.getElementById('tempo-text');\r\n        if (tempoText) {\r\n            tempoText.textContent = this.getTempoText(newBpm);\r\n        }\r\n    }\r\n\r\n    private getTempoText(bpm: number): string {\r\n        if (bpm < 40) return 'Grave (\u975E\u5E38\u306B\u9045\u304F)';\r\n        if (bpm < 50) return 'Largo (\u5E45\u5E83\u304F\u3001\u9045\u304F)';\r\n        if (bpm < 60) return 'Lento (\u9045\u304F)';\r\n        if (bpm < 66) return 'Larghetto (Largo\u3088\u308A\u3084\u3084\u901F\u304F)';\r\n        if (bpm < 76) return 'Adagio (\u3086\u308B\u3084\u304B\u306B)';\r\n        if (bpm < 108) return 'Andante (\u6B69\u304F\u3088\u3046\u306A\u901F\u3055\u3067)';\r\n        if (bpm < 120) return 'Moderato (\u4E2D\u304F\u3089\u3044\u306E\u901F\u3055\u3067)';\r\n        if (bpm < 156) return 'Allegro (\u5FEB\u6D3B\u306B\u901F\u304F)';\r\n        if (bpm < 176) return 'Vivace (\u751F\u304D\u751F\u304D\u3068\u901F\u304F)';\r\n        if (bpm < 200) return 'Presto (\u6025\u901F\u306B)';\r\n        return 'Prestissimo (\u6975\u3081\u3066\u6025\u901F\u306B)';\r\n    }\r\n\r\n    private setupTapTempo(tapBtn: HTMLElement) {\r\n        let tapTimes: number[] = [];\r\n        const TAP_TIMEOUT = 2000;\r\n\r\n        tapBtn.addEventListener('click', () => {\r\n            const now = Date.now();\r\n\r\n            if (tapTimes.length > 0 && now - tapTimes[tapTimes.length - 1] > TAP_TIMEOUT) {\r\n                tapTimes = [];\r\n            }\r\n\r\n            tapTimes.push(now);\r\n\r\n            if (tapTimes.length > 4) {\r\n                tapTimes.shift();\r\n            }\r\n\r\n            if (tapTimes.length >= 2) {\r\n                let intervals = [];\r\n                for (let i = 1; i < tapTimes.length; i++) {\r\n                    intervals.push(tapTimes[i] - tapTimes[i - 1]);\r\n                }\r\n\r\n                const avgInterval = intervals.reduce((a, b) => a + b) / intervals.length;\r\n                const calculatedBpm = Math.round(60000 / avgInterval);\r\n\r\n                if (calculatedBpm >= 30 && calculatedBpm <= 250) {\r\n                    this.updateTempo(calculatedBpm);\r\n                }\r\n            }\r\n\r\n            const originalText = tapBtn.innerHTML;\r\n            tapBtn.innerHTML = '\uD83D\uDC63 Tapped!';\r\n            tapBtn.style.color = 'var(--color-primary-light)';\r\n            tapBtn.style.borderColor = 'var(--color-primary)';\r\n\r\n            setTimeout(() => {\r\n                tapBtn.innerHTML = originalText;\r\n                tapBtn.style.color = '';\r\n                tapBtn.style.borderColor = '';\r\n            }, 300);\r\n        });\r\n    }\r\n\r\n    private setupSettingsModal() {\r\n        const settingsToggleBtn = document.getElementById('settings-toggle-btn');\r\n        const settingsPanel = document.getElementById('settings-panel');\r\n        const closeSettingsBtn = document.getElementById('close-settings-btn');\r\n        const pendulumToggle = document.getElementById('pendulum-toggle') as HTMLInputElement;\r\n        const pendulumContainer = document.getElementById('pendulum-container');\r\n\r\n        if (settingsToggleBtn && settingsPanel && closeSettingsBtn) {\r\n            const togglePanel = () => {\r\n                settingsPanel.classList.toggle('hidden');\r\n            };\r\n\r\n            settingsToggleBtn.addEventListener('click', togglePanel);\r\n            closeSettingsBtn.addEventListener('click', togglePanel);\r\n        }\r\n\r\n        if (pendulumToggle && pendulumContainer) {\r\n            pendulumToggle.addEventListener('change', (e) => {\r\n                if ((e.target as HTMLInputElement).checked) {\r\n                    pendulumContainer.classList.remove('hidden');\r\n                } else {\r\n                    pendulumContainer.classList.add('hidden');\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    public stop() {\r\n        if (this.metronome.isPlaying) {\r\n            this.metronome.stop();\r\n            this.playBtn?.classList.remove('playing');\r\n        }\r\n    }\r\n}\r\n", "import { WakeLock } from '../core/WakeLock';\r\n\r\nexport class TimerUI {\r\n    private timerInterval: number | null = null;\r\n    private elapsedTime: number = 0; // milliseconds\r\n    private isRunning: boolean = false;\r\n    private isCountdown: boolean = false;\r\n    private countdownTarget: number = 0;\r\n    private laps: { time: number, diff: number }[] = [];\r\n    private lastLapTime: number = 0;\r\n    private wakeLock: WakeLock;\r\n\r\n    // UI Elements\r\n    private timerDisplay: HTMLElement | null = null;\r\n    private timerMs: HTMLElement | null = null;\r\n    private startBtn: HTMLButtonElement | null = null;\r\n    private stopBtn: HTMLButtonElement | null = null;\r\n    private resetBtn: HTMLElement | null = null;\r\n    private lapBtn: HTMLButtonElement | null = null;\r\n    private lapList: HTMLElement | null = null;\r\n    private countdownSettings: HTMLElement | null = null;\r\n    private countdownMinutes: HTMLInputElement | null = null;\r\n    private countdownSeconds: HTMLInputElement | null = null;\r\n\r\n    constructor() {\r\n        this.wakeLock = WakeLock.getInstance();\r\n    }\r\n\r\n    public init() {\r\n        this.timerDisplay = document.getElementById('timer-display');\r\n        this.timerMs = document.getElementById('timer-ms');\r\n        this.startBtn = document.getElementById('timer-start-btn') as HTMLButtonElement;\r\n        this.stopBtn = document.getElementById('timer-stop-btn') as HTMLButtonElement;\r\n        this.resetBtn = document.getElementById('timer-reset-btn');\r\n        this.lapBtn = document.getElementById('lap-btn') as HTMLButtonElement;\r\n        this.lapList = document.getElementById('lap-list');\r\n        const timerTabs = document.querySelectorAll('.timer-tab');\r\n        this.countdownSettings = document.getElementById('countdown-settings');\r\n        this.countdownMinutes = document.getElementById('countdown-minutes') as HTMLInputElement;\r\n        this.countdownSeconds = document.getElementById('countdown-seconds') as HTMLInputElement;\r\n\r\n        if (!this.timerDisplay || !this.startBtn) return;\r\n\r\n        // Event listeners\r\n        this.startBtn.addEventListener('click', this.startTimer.bind(this));\r\n        if (this.stopBtn) this.stopBtn.addEventListener('click', this.stopTimer.bind(this));\r\n        if (this.resetBtn) this.resetBtn.addEventListener('click', this.resetTimer.bind(this));\r\n        if (this.lapBtn) this.lapBtn.addEventListener('click', this.recordLap.bind(this));\r\n\r\n        // Tab switching\r\n        timerTabs.forEach(tab => {\r\n            tab.addEventListener('click', () => {\r\n                timerTabs.forEach(t => t.classList.remove('active'));\r\n                tab.classList.add('active');\r\n\r\n                this.isCountdown = (tab as HTMLElement).dataset.mode === 'countdown';\r\n                if (this.countdownSettings) {\r\n                    this.countdownSettings.classList.toggle('hidden', !this.isCountdown);\r\n                }\r\n\r\n                this.resetTimer();\r\n            });\r\n        });\r\n\r\n        this.updateDisplay();\r\n    }\r\n\r\n    private formatTime(ms: number): string {\r\n        const totalSeconds = Math.floor(ms / 1000);\r\n        const hours = Math.floor(totalSeconds / 3600);\r\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\r\n        const seconds = totalSeconds % 60;\r\n        return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\r\n    }\r\n\r\n    private formatMs(ms: number): string {\r\n        return `.${String(Math.floor((ms % 1000) / 10)).padStart(2, '0')}`;\r\n    }\r\n\r\n    private updateDisplay() {\r\n        const displayTime = this.isCountdown ? Math.max(0, this.countdownTarget - this.elapsedTime) : this.elapsedTime;\r\n\r\n        if (this.timerDisplay) this.timerDisplay.textContent = this.formatTime(displayTime);\r\n        if (this.timerMs) this.timerMs.textContent = this.formatMs(displayTime);\r\n\r\n        // Countdown finished\r\n        if (this.isCountdown && displayTime <= 0 && this.isRunning) {\r\n            this.stopTimer();\r\n            if (this.timerDisplay) this.timerDisplay.style.color = '#ef4444';\r\n            this.playTimerBeep();\r\n        }\r\n    }\r\n\r\n    private playTimerBeep() {\r\n        try {\r\n            const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;\r\n            const audioCtx = new AudioContextClass();\r\n            const oscillator = audioCtx.createOscillator();\r\n            const gainNode = audioCtx.createGain();\r\n\r\n            oscillator.type = 'sine';\r\n            oscillator.frequency.value = 880;\r\n            gainNode.gain.value = 0.3;\r\n\r\n            oscillator.connect(gainNode);\r\n            gainNode.connect(audioCtx.destination);\r\n\r\n            oscillator.start();\r\n            oscillator.stop(audioCtx.currentTime + 0.5);\r\n        } catch (e) {\r\n            console.log('Audio not available');\r\n        }\r\n    }\r\n\r\n    private startTimer() {\r\n        if (this.isRunning) return;\r\n\r\n        if (this.isCountdown) {\r\n            const mins = this.countdownMinutes ? parseInt(this.countdownMinutes.value) || 0 : 0;\r\n            const secs = this.countdownSeconds ? parseInt(this.countdownSeconds.value) || 0 : 0;\r\n            this.countdownTarget = (mins * 60 + secs) * 1000;\r\n            if (this.countdownTarget <= 0) return;\r\n        }\r\n\r\n        this.isRunning = true;\r\n        this.wakeLock.requestWakeLock();\r\n        const startTime = Date.now() - this.elapsedTime;\r\n\r\n        this.timerInterval = window.setInterval(() => {\r\n            this.elapsedTime = Date.now() - startTime;\r\n            this.updateDisplay();\r\n        }, 10);\r\n\r\n        if (this.startBtn) this.startBtn.disabled = true;\r\n        if (this.stopBtn) this.stopBtn.disabled = false;\r\n        if (this.lapBtn) this.lapBtn.disabled = false;\r\n        if (this.timerDisplay) this.timerDisplay.style.color = '';\r\n    }\r\n\r\n    private stopTimer() {\r\n        if (!this.isRunning) return;\r\n\r\n        this.isRunning = false;\r\n        this.wakeLock.releaseWakeLock();\r\n        if (this.timerInterval !== null) {\r\n            clearInterval(this.timerInterval);\r\n            this.timerInterval = null;\r\n        }\r\n\r\n        if (this.startBtn) this.startBtn.disabled = false;\r\n        if (this.stopBtn) this.stopBtn.disabled = true;\r\n    }\r\n\r\n    private resetTimer() {\r\n        this.stopTimer();\r\n        this.elapsedTime = 0;\r\n        this.laps = [];\r\n        this.lastLapTime = 0;\r\n        this.updateDisplay();\r\n\r\n        if (this.lapList) this.lapList.innerHTML = '';\r\n        if (this.lapBtn) this.lapBtn.disabled = true;\r\n        if (this.timerDisplay) this.timerDisplay.style.color = '';\r\n    }\r\n\r\n    private recordLap() {\r\n        if (!this.isRunning) return;\r\n\r\n        const lapTime = this.elapsedTime;\r\n        const lapDiff = lapTime - this.lastLapTime;\r\n        this.lastLapTime = lapTime;\r\n        this.laps.push({ time: lapTime, diff: lapDiff });\r\n\r\n        if (this.lapList) {\r\n            const li = document.createElement('li');\r\n            li.className = 'lap-item';\r\n            li.innerHTML = `\r\n                <span class=\"lap-number\">#${this.laps.length}</span>\r\n                <span class=\"lap-time\">${this.formatTime(lapTime)}${this.formatMs(lapTime)}</span>\r\n                <span class=\"lap-diff\">+${this.formatTime(lapDiff)}${this.formatMs(lapDiff)}</span>\r\n            `;\r\n            this.lapList.insertBefore(li, this.lapList.firstChild);\r\n        }\r\n    }\r\n}\r\n", "export interface PracticeRecord {\r\n    timestamp: number;\r\n    startTempo: string;\r\n    endTempo: string;\r\n    beatsPerPhrase: string;\r\n    repetitions: string;\r\n    formattedTime: string;\r\n}\r\n\r\nexport class PracticeRecordsUI {\r\n    private readonly STORAGE_KEY = 'tpc_practice_records';\r\n    private records: PracticeRecord[] = [];\r\n\r\n    // UI Elements\r\n    private saveBtn: HTMLElement | null = null;\r\n    private clearBtn: HTMLElement | null = null;\r\n    private recordsList: HTMLElement | null = null;\r\n\r\n    constructor() { }\r\n\r\n    public init() {\r\n        this.saveBtn = document.getElementById('save-record-btn');\r\n        this.clearBtn = document.getElementById('clear-records-btn');\r\n        this.recordsList = document.getElementById('records-list');\r\n\r\n        this.loadRecords();\r\n        this.renderRecords();\r\n\r\n        if (this.saveBtn) {\r\n            this.saveBtn.addEventListener('click', this.handleSave.bind(this));\r\n        }\r\n\r\n        if (this.clearBtn) {\r\n            this.clearBtn.addEventListener('click', this.handleClear.bind(this));\r\n        }\r\n    }\r\n\r\n    private loadRecords() {\r\n        try {\r\n            const saved = localStorage.getItem(this.STORAGE_KEY);\r\n            if (saved) {\r\n                this.records = JSON.parse(saved);\r\n            }\r\n        } catch (e) {\r\n            console.error('Failed to load practice records', e);\r\n        }\r\n    }\r\n\r\n    private saveAndRender() {\r\n        try {\r\n            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.records));\r\n            this.renderRecords();\r\n        } catch (e) {\r\n            console.error('Failed to save practice records', e);\r\n        }\r\n    }\r\n\r\n    private renderRecords() {\r\n        if (!this.recordsList) return;\r\n\r\n        if (this.records.length === 0) {\r\n            this.recordsList.innerHTML = `\r\n                <div class=\"empty-state\" style=\"text-align: center; padding: var(--space-xl); color: var(--color-text-muted);\">\r\n                    <div style=\"font-size: 3rem; margin-bottom: var(--space-sm); opacity: 0.5;\">\uD83D\uDCDD</div>\r\n                    <p>\u8A18\u9332\u304C\u3042\u308A\u307E\u305B\u3093</p>\r\n                    <p style=\"font-size: var(--font-size-xs);\">\u8A08\u7B97\u7D50\u679C\u753B\u9762\u304B\u3089\u300C\u7DF4\u7FD2\u8A18\u9332\u306B\u4FDD\u5B58\u300D\u3092\u30AF\u30EA\u30C3\u30AF\u3059\u308B\u3068\u8868\u793A\u3055\u308C\u307E\u3059</p>\r\n                </div>`;\r\n            return;\r\n        }\r\n\r\n        this.recordsList.innerHTML = this.records.map((record, index) => {\r\n            const date = new Date(record.timestamp);\r\n            const dateStr = `${date.getFullYear()}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\r\n\r\n            return `\r\n                <div class=\"record-item\" style=\"background: rgba(15, 23, 42, 0.4); border: 1px solid var(--color-border); border-radius: var(--radius-md); padding: var(--space-md); margin-bottom: var(--space-md); display: flex; justify-content: space-between; align-items: center;\">\r\n                    <div class=\"record-info\">\r\n                        <div style=\"font-size: var(--font-size-xs); color: var(--color-text-muted); margin-bottom: var(--space-xs);\">${dateStr}</div>\r\n                        <div style=\"font-size: var(--font-size-base); font-weight: 500; color: var(--color-text-primary);\">\r\n                            \uD83C\uDFB5 ${record.startTempo} BPM \u2192 \uD83C\uDFAF ${record.endTempo} BPM\r\n                        </div>\r\n                        <div style=\"font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--space-xs);\">\r\n                            \u23F1\uFE0F \u6642\u9593: ${record.formattedTime} | \uD83C\uDFBC ${record.beatsPerPhrase}\u62CD \u00D7 ${record.repetitions}\u56DE\r\n                        </div>\r\n                    </div>\r\n                    <button type=\"button\" class=\"control-btn small delete-record-btn\" data-index=\"${index}\" style=\"color: #ef4444; border-color: rgba(239, 68, 68, 0.3);\">\r\n                        \uD83D\uDDD1\uFE0F\r\n                    </button>\r\n                </div>\r\n            `;\r\n        }).join('');\r\n\r\n        // Add delete listeners\r\n        this.recordsList.querySelectorAll('.delete-record-btn').forEach(btn => {\r\n            btn.addEventListener('click', (e) => {\r\n                const target = e.currentTarget as HTMLElement;\r\n                const idx = parseInt(target.getAttribute('data-index') || '0', 10);\r\n                this.records.splice(idx, 1);\r\n                this.saveAndRender();\r\n            });\r\n        });\r\n    }\r\n\r\n    private handleSave() {\r\n        const totalTimeElem = document.getElementById('totalTime');\r\n        if (!totalTimeElem || totalTimeElem.textContent === '--:--') {\r\n            this.showFeedbackError('\u8A08\u7B97\u7D50\u679C\u304C\u3042\u308A\u307E\u305B\u3093');\r\n            return;\r\n        }\r\n\r\n        const form = document.getElementById('calculator-form') as HTMLFormElement;\r\n        const formData = new FormData(form);\r\n\r\n        const record: PracticeRecord = {\r\n            timestamp: Date.now(),\r\n            startTempo: formData.get('startTempo') as string,\r\n            endTempo: formData.get('endTempo') as string,\r\n            beatsPerPhrase: formData.get('beatsPerPhrase') as string,\r\n            repetitions: formData.get('repetitions') as string,\r\n            formattedTime: totalTimeElem.textContent || ''\r\n        };\r\n\r\n        this.records.unshift(record);\r\n        this.saveAndRender();\r\n\r\n        if (this.saveBtn) {\r\n            const originalText = this.saveBtn.innerHTML;\r\n            const originalBackground = this.saveBtn.style.background;\r\n\r\n            this.saveBtn.innerHTML = '<span class=\"btn-icon\">\u2705</span> \u4FDD\u5B58\u3057\u307E\u3057\u305F';\r\n            this.saveBtn.style.background = 'var(--color-primary)'; // \u4FDD\u5B58\u6210\u529F\u6642\u306F\u30C6\u30FC\u30DE\u306B\u5408\u308F\u305B\u305F\u30D7\u30E9\u30A4\u30DE\u30EA\u30AB\u30E9\u30FC\u306B\r\n\r\n            setTimeout(() => {\r\n                if (this.saveBtn) {\r\n                    this.saveBtn.innerHTML = originalText;\r\n                    this.saveBtn.style.background = originalBackground;\r\n                }\r\n            }, 2000);\r\n        }\r\n    }\r\n\r\n    private handleClear() {\r\n        if (this.records.length === 0) return;\r\n        if (confirm('\u3059\u3079\u3066\u306E\u7DF4\u7FD2\u8A18\u9332\u3092\u6D88\u53BB\u3057\u307E\u3059\u304B\uFF1F')) {\r\n            this.records = [];\r\n            this.saveAndRender();\r\n        }\r\n    }\r\n\r\n    private showFeedbackError(message: string) {\r\n        // Simple alert for now, could be integrated with CalculatorUI's showError\r\n        alert(message);\r\n    }\r\n}\r\n", "import { MetronomeUI } from './MetronomeUI';\r\n\r\nexport class NavigationManager {\r\n    private navMenu: HTMLElement | null = null;\r\n    private tabItems: NodeListOf<HTMLElement> | null = null;\r\n    private viewSections: NodeListOf<HTMLElement> | null = null;\r\n\r\n    private metronomeUI: MetronomeUI | null = null;\r\n\r\n    constructor() { }\r\n\r\n    public setMetronomeUI(metronomeUI: MetronomeUI) {\r\n        this.metronomeUI = metronomeUI;\r\n    }\r\n\r\n    public init() {\r\n        this.navMenu = document.getElementById('nav-menu');\r\n        this.tabItems = document.querySelectorAll('.tab-item');\r\n        this.viewSections = document.querySelectorAll('.view-section');\r\n\r\n        if (!this.navMenu) {\r\n            console.error('Navigation elements not found. Check HTML IDs.');\r\n            return;\r\n        }\r\n\r\n        if (this.tabItems) {\r\n            this.tabItems.forEach(item => {\r\n                item.addEventListener('click', () => {\r\n                    const targetId = item.getAttribute('data-target');\r\n\r\n                    // Switch View\r\n                    if (this.viewSections) {\r\n                        this.viewSections.forEach(section => {\r\n                            if (section.id === targetId) {\r\n                                section.classList.remove('hidden');\r\n                                section.classList.add('active');\r\n                            } else {\r\n                                section.classList.add('hidden');\r\n                                section.classList.remove('active');\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    // Update Tab State\r\n                    if (this.tabItems) {\r\n                        this.tabItems.forEach(nav => nav.classList.remove('active'));\r\n                    }\r\n                    item.classList.add('active');\r\n\r\n                    // Stop metronome if leaving metronome view\r\n                    if (targetId !== 'metronome-view' && this.metronomeUI) {\r\n                        this.metronomeUI.stop();\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    }\r\n}\r\n", "export class VisualEffects {\r\n    public static init() {\r\n        this.initRipple();\r\n        this.initParallax();\r\n    }\r\n\r\n    private static initRipple() {\r\n        document.addEventListener('mousedown', (e) => {\r\n            const target = e.target as HTMLElement;\r\n            // Get closest button that supports ripple\r\n            const button = target.closest('.icon-btn, .control-btn, .calculate-btn, .play-btn, .timer-btn, .settings-toggle-btn, .timer-tab, .lap-record-btn, .close-settings-btn, .tap-btn') as HTMLElement;\r\n\r\n            if (!button) return;\r\n            if ((button as HTMLButtonElement).disabled) return;\r\n\r\n            const ripple = document.createElement('span');\r\n            ripple.classList.add('ripple-effect');\r\n\r\n            const rect = button.getBoundingClientRect();\r\n            const size = Math.max(rect.width, rect.height);\r\n\r\n            ripple.style.width = ripple.style.height = `${size}px`;\r\n\r\n            const x = e.clientX - rect.left - size / 2;\r\n            const y = e.clientY - rect.top - size / 2;\r\n\r\n            ripple.style.left = `${x}px`;\r\n            ripple.style.top = `${y}px`;\r\n\r\n            button.appendChild(ripple);\r\n\r\n            setTimeout(() => {\r\n                ripple.remove();\r\n            }, 600);\r\n        });\r\n    }\r\n\r\n    private static initParallax() {\r\n        const orbs = document.querySelectorAll('.orb') as NodeListOf<HTMLElement>;\r\n        if (orbs.length === 0) return;\r\n\r\n        // Use requestAnimationFrame for smooth performance\r\n        let isTicking = false;\r\n        let mouseX = 0;\r\n        let mouseY = 0;\r\n\r\n        document.addEventListener('mousemove', (e) => {\r\n            mouseX = e.clientX;\r\n            mouseY = e.clientY;\r\n\r\n            if (!isTicking) {\r\n                requestAnimationFrame(() => {\r\n                    const x = mouseX / window.innerWidth - 0.5;\r\n                    const y = mouseY / window.innerHeight - 0.5;\r\n\r\n                    orbs.forEach((orb, index) => {\r\n                        // Different depths for each orb\r\n                        const depthX = (index + 1) * 30;\r\n                        const depthY = (index + 1) * 20;\r\n                        const moveX = x * depthX * -1;\r\n                        const moveY = y * depthY * -1;\r\n\r\n                        // Apply margin without overwriting the original CSS animation (transform)\r\n                        orb.style.marginLeft = `${moveX}px`;\r\n                        orb.style.marginTop = `${moveY}px`;\r\n                    });\r\n\r\n                    isTicking = false;\r\n                });\r\n                isTicking = true;\r\n            }\r\n        });\r\n    }\r\n}\r\n", "/**\r\n * Tempo Practice Calculator - Main Entry Point\r\n * TypeScript\u7248\u30A8\u30F3\u30C8\u30EA\u30FC\u30DD\u30A4\u30F3\u30C8\r\n */\r\n\r\n// Core modules\r\nexport { DeviceIdentifier, getDeviceId, clearDeviceId } from './core/DeviceIdentifier';\r\nexport { PrecisionTimer, getPrecisionTimer } from './core/PrecisionTimer';\r\nexport { ActionLogger, logAction, logError, logWarn } from './core/ActionLogger';\r\nexport { calculateTempoPracticeTime } from './core/Calculator';\r\nexport { Metronome } from './core/Metronome';\r\n\r\n// UI modules\r\nexport { TouchController, initTouchController } from './ui/TouchController';\r\nexport { ThemeManager, setThemeMode, setBackgroundColor } from './ui/ThemeManager';\r\nexport { DataManager, initDataManager, exportAppData } from './ui/DataManager';\r\n\r\n// Types\r\nexport * from './types';\r\n\r\n// Initialize function\r\nimport { DeviceIdentifier } from './core/DeviceIdentifier';\r\nimport { ActionLogger } from './core/ActionLogger';\r\nimport { TouchController } from './ui/TouchController';\r\nimport { ThemeManager } from './ui/ThemeManager';\r\nimport { DataManager } from './ui/DataManager';\r\n\r\n// New UI Controllers\r\nimport { CalculatorUI } from './ui/CalculatorUI';\r\nimport { MetronomeUI } from './ui/MetronomeUI';\r\nimport { TimerUI } from './ui/TimerUI';\r\nimport { PracticeRecordsUI } from './ui/PracticeRecordsUI';\r\nimport { NavigationManager } from './ui/NavigationManager';\r\nimport { VisualEffects } from './ui/VisualEffects';\r\n\r\n/**\r\n * \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u521D\u671F\u5316\r\n */\r\nexport function initializeApp(): void {\r\n    // \u30C7\u30D0\u30A4\u30B9ID\u3092\u521D\u671F\u5316\uFF08\u81EA\u52D5\u751F\u6210\uFF09\r\n    const deviceId = DeviceIdentifier.getInstance().getId();\r\n    console.log(`[TPC] Device ID: ${deviceId}`);\r\n\r\n    // \u30A2\u30AF\u30B7\u30E7\u30F3\u30ED\u30B0\u3092\u521D\u671F\u5316\r\n    ActionLogger.getInstance().info('app_initialized', {\r\n        deviceId,\r\n        timestamp: Date.now(),\r\n        url: window.location.href\r\n    });\r\n\r\n    // \u30BF\u30C3\u30C1\u5236\u5FA1\u3092\u521D\u671F\u5316\r\n    TouchController.getInstance().init();\r\n\r\n    // \u30C6\u30FC\u30DE\u3092\u9069\u7528\r\n    const themeManager = ThemeManager.getInstance();\r\n    themeManager.applyTheme();\r\n    themeManager.initUI();\r\n\r\n    // \u8996\u899A\u30A8\u30D5\u30A7\u30AF\u30C8\uFF08\u6CE2\u7D0B\u30FB\u30D1\u30E9\u30E9\u30C3\u30AF\u30B9\uFF09\u3092\u521D\u671F\u5316\r\n    VisualEffects.init();\r\n\r\n    // \u524A\u9664\u30DC\u30BF\u30F3\u3092\u521D\u671F\u5316\uFF08\u5B58\u5728\u3059\u308B\u5834\u5408\uFF09\r\n    const deleteBtn = document.getElementById('delete-all-btn');\r\n    const deleteProgress = document.getElementById('delete-progress');\r\n    if (deleteBtn && deleteProgress) {\r\n        DataManager.getInstance().initDeleteButton('delete-all-btn', 'delete-progress');\r\n    }\r\n\r\n    // \u5404UI\u306E\u521D\u671F\u5316\r\n    const calculatorUI = new CalculatorUI();\r\n    calculatorUI.init();\r\n\r\n    const metronomeUI = new MetronomeUI();\r\n    metronomeUI.init();\r\n\r\n    const timerUI = new TimerUI();\r\n    timerUI.init();\r\n\r\n    const practiceRecordsUI = new PracticeRecordsUI();\r\n    practiceRecordsUI.init();\r\n\r\n    const navManager = new NavigationManager();\r\n    navManager.init();\r\n    navManager.setMetronomeUI(metronomeUI);\r\n\r\n    console.log('[TPC] Tempo Practice Calculator initialized (TypeScript Edition Phase 6)');\r\n}\r\n\r\n// DOMContentLoaded\u6642\u306B\u81EA\u52D5\u521D\u671F\u5316\r\nif (typeof document !== 'undefined') {\r\n    if (document.readyState === 'loading') {\r\n        document.addEventListener('DOMContentLoaded', initializeApp);\r\n    } else {\r\n        initializeApp();\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["STORAGE_KEYS", "_DeviceIdentifier", "STORAGE_KEYS", "saved", "e", "newId", "c", "r", "str", "DeviceIdentifier", "getDeviceId", "clearDeviceId", "PrecisionTimer", "buffer", "source", "callback", "delayMs", "scheduledTime", "correctedDelay", "timerId", "actualTime", "intervalMs", "isRunning", "nextTime", "tick", "drift", "metrics", "bpm", "subdivision", "originalDelay", "correction", "scheduled", "actual", "removed", "precisionTimerInstance", "getPrecisionTimer", "_ActionLogger", "level", "action", "details", "entry", "getDeviceId", "log", "now", "latencies", "a", "b", "logsToSave", "STORAGE_KEYS", "saved", "parsed", "ActionLogger", "logAction", "logError", "logWarn", "kahanSum", "numbers", "sum", "compensation", "i", "y", "t", "calculateTempoPracticeTime", "params", "a", "b", "s", "B", "R", "N", "K", "n", "bPrime", "C", "stepTimes", "k", "tempo", "stepTime", "totalExact", "S", "P", "termIntegral", "termCorrection", "totalApprox", "errorRate", "formatTime", "seconds", "hours", "minutes", "secs", "WakeLock", "_WakeLock", "err", "Metronome", "WakeLock", "callback", "secondsPerNote", "beatNumber", "subdivisionNumber", "time", "isMainBeat", "isAccent", "drawTime", "osc", "envelope", "baseVolume", "click", "clickEnv", "AudioContextClass", "unlockAudio", "warmupAudio", "buffer", "source", "err", "bpm", "beats", "type", "value", "enabled", "_TouchController", "logAction", "logWarn", "navMenu", "navOverlay", "e", "scrollable", "deltaY", "atTop", "atBottom", "lastTouchEnd", "now", "element", "viewport", "callback", "handler", "TouchController", "initTouchController", "_ThemeManager", "hex", "rgb", "r", "g", "b", "color1", "color2", "l1", "l2", "lighter", "darker", "bgColor", "brightness", "baseColor", "baseAccent", "bgBrightness", "accentRgb", "accentHsl", "mode", "logAction", "themeSelect", "e", "root", "data", "STORAGE_KEYS", "saved", "result", "x", "max", "min", "h", "s", "d", "hsl", "l", "hue2rgb", "p", "q", "t", "value", "ThemeManager", "setThemeMode", "setBackgroundColor", "color", "_DataManager", "buttonId", "progressId", "options", "button", "progress", "logWarn", "e", "logAction", "progressElement", "updateProgress", "elapsed", "STORAGE_KEYS", "key", "DeviceIdentifier", "keys", "storageKey", "items", "totalUsed", "value", "size", "data", "name", "jsonString", "imported", "DataManager", "initDataManager", "exportAppData", "CalculatorUI", "formData", "params", "result", "calculateTempoPracticeTime", "error", "input", "min", "max", "value", "exactSeconds", "approxSeconds", "errorRate", "actualEndTempo", "totalBeatsPerStep", "formatTime", "v", "sign", "totalTimeCard", "message", "element", "targetValue", "formatter", "duration", "startTime", "updateNumber", "currentTime", "elapsed", "progress", "easeOut", "currentValue", "MetronomeUI", "Metronome", "bpmIncrease", "bpmDecrease", "tapBtn", "timeSignatureSelect", "subdivisionSelect", "soundSelect", "volumeSlider", "pendulumToggle", "pendulumArm", "beatNumber", "isMainBeat", "isAccent", "direction", "e", "bpm", "newBpm", "tempoText", "tapTimes", "now", "intervals", "i", "avgInterval", "a", "b", "calculatedBpm", "originalText", "settingsToggleBtn", "settingsPanel", "closeSettingsBtn", "pendulumContainer", "togglePanel", "TimerUI", "WakeLock", "timerTabs", "tab", "t", "ms", "totalSeconds", "hours", "minutes", "seconds", "displayTime", "AudioContextClass", "audioCtx", "oscillator", "gainNode", "mins", "secs", "startTime", "lapTime", "lapDiff", "li", "PracticeRecordsUI", "saved", "record", "index", "date", "btn", "e", "target", "idx", "totalTimeElem", "form", "formData", "originalText", "originalBackground", "message", "NavigationManager", "metronomeUI", "item", "targetId", "section", "nav", "VisualEffects", "button", "ripple", "rect", "size", "x", "y", "orbs", "isTicking", "mouseX", "mouseY", "e", "orb", "index", "depthX", "depthY", "moveX", "moveY", "initializeApp", "deviceId", "DeviceIdentifier", "ActionLogger", "TouchController", "themeManager", "ThemeManager", "VisualEffects", "deleteBtn", "deleteProgress", "DataManager", "CalculatorUI", "metronomeUI", "MetronomeUI", "TimerUI", "PracticeRecordsUI", "navManager", "NavigationManager"]
}
